<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <title>Agrilogy - Bridging the Digital Divide in Agriculture</title>
    <script src="https://cdn.lordicon.com/lordicon.js"></script>
    <meta name="description" content="Agrilogy connects offline and online farmers through hybrid technology, bringing real-time insights, market data, and AI-powered guidance to every field. Now featuring an Offline AI Soil Monitor.">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/MotionPathPlugin.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        :root {
          --primary: 120 40% 35%;      /* Deep Leaf Green */
          --primary-glow: 120 40% 45%;   /* Brighter Leaf Green */
          --secondary: 45 70% 60%;     /* Golden Wheat */
          --accent: 25 50% 45%;        /* Terracotta */
          --background: 40 30% 97%;      /* Warm Off-White */
          --foreground: 30 25% 20%;      /* Rich Soil Brown */
          --card: 40 25% 94%;         /* Light Beige */
          --muted: 40 20% 92%;        /* Muted Beige */
          --border: 40 15% 88%;       /* Soft Beige Border */
          --success: 140 60% 40%;      /* A vibrant, positive green */
        }
        
        body {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: hsl(var(--card) / 0.7);
            border: 1px solid hsl(var(--card) / 0.2);
            box-shadow: 0 8px 32px hsl(var(--primary) / 0.1);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 20px hsl(var(--primary) / 0.3); }
            50% { box-shadow: 0 0 40px hsl(var(--primary) / 0.6); }
        }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .float { animation: float 3s ease-in-out infinite; }
        .glow-pulse { animation: glow-pulse 2s ease-in-out infinite; }
        .fade-in { animation: fade-in 0.6s ease-out forwards; }
        
        .glow-on-hover:hover, .glass-panel:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px hsl(var(--primary) / 0.2);
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
        }
        
        .hero-bg {
          background: linear-gradient(135deg, hsl(var(--primary) / 0.4), hsl(var(--primary-glow) / 0.5)),
                      url('farmpic.jpeg');
          background-size: cover;
          background-position: center;
        }
        .hero-text-shadow {
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }
        
        /* Reverting button glow to a more subtle shadow */
        button:hover, .hover\:scale-105:hover {
          transform: scale(1.05);
          box-shadow: 0 4px 15px hsl(var(--primary) / 0.2);
          transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .status-good { color: hsl(var(--primary)); }
        .status-warning { color: hsl(var(--accent)); }
        .status-critical { color: #ef4444; }

        /* Styles for the new offline module footer */
        .offline-footer-btn:hover {
            background-color: #f3f4f6; /* Equivalent to hover:bg-gray-100 */
        }

        /* Styles for the new side plant animation */
        #side-plant-container {
            opacity: 0.7;
        }

        /* --- NEW: AgriMitra Flip Card Styles --- */
        .flip-card {
            perspective: 1000px;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.7s;
            transform-style: preserve-3d;
        }
        /* MODIFIED: Flip on hover for devices that support it */
        @media (hover: hover) and (pointer: fine) {
            .flip-card:hover .flip-card-inner {
                transform: rotateY(180deg);
            }
        }
        /* NEW: Add a class to flip the card on click/tap */
        .flip-card.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
        }
        .flip-card-back {
            transform: rotateY(180deg);
        }

        /* --- NEW: How It Works Modal Styles --- */
        #how-it-works-modal {
            transition: opacity 0.3s ease;
        }
        #how-it-works-modal.hidden {
            pointer-events: none;
        }
        #how-it-works-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
            transform: scale(0.95);
            opacity: 0;
        }
        #how-it-works-modal:not(.hidden) #how-it-works-content {
            transform: scale(1);
            opacity: 1;
        }
        #close-how-it-works-btn {
            font-size: 2rem;
            line-height: 1;
        }

        /* --- NEW: Sell Now Modal Styles --- */
        #sell-now-modal {
            transition: opacity 0.3s ease;
        }
        #sell-now-modal.hidden {
            pointer-events: none;
        }
        #sell-now-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
            transform: scale(0.95);
            opacity: 0;
        }
        #sell-now-modal:not(.hidden) #sell-now-content {
            transform: scale(1);
            opacity: 1;
        }
        #close-sell-now-btn {
            font-size: 2rem;
            line-height: 1;
        }

        /* --- NEW: Farm Plot Card Styles --- */
        .plot-card {
            @apply relative p-4 rounded-2xl overflow-hidden transition-all duration-300 ease-in-out;
            background-size: cover;
            background-position: center;
        }
        .plot-card::before {
            content: '';
            @apply absolute inset-0 bg-black/50;
        }
        .plot-card-content {
            @apply relative z-10;
        }
        .plot-card:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .plot-card:hover::before {
            @apply bg-black/40;
        }

        /* --- NEW: Flat & Visually Appealing Farm View Styles --- */
        .farm-layout {
            display: grid;
            grid-template-columns: 1fr; /* Mobile: single column */
            gap: 1rem;
            grid-template-areas:
                "plotA"
                "plotB"
                "plotC"
                "plotD"
                "plotE";
            height: auto; /* Let it grow on mobile */
        }
        @media (min-width: 768px) { /* md breakpoint */
            .farm-layout { 
                grid-template-columns: repeat(3, 1fr);
                height: 600px; 
                grid-template-areas: 
                    "plotA plotA plotB" 
                    "plotA plotA plotC" 
                    "plotD plotE plotC"; 
            }
        }

        .flat-plot {
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease-out;
            position: relative;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .flat-plot:hover, .flat-plot.active, .flat-plot:focus-visible {
            transform: scale(1.03);
            border-color: hsl(var(--primary) / 0.8);
            box-shadow: 0 0 20px hsl(var(--primary) / 0.5);
        }
        .plot-pattern {
            position: absolute;
            inset: 0;
            opacity: 0.1;
            background-size: 20px 20px;
            z-index: 0;
        }

        /* --- REVISED: Dashboard Plot Flip Card Styles --- */
        .plot-flip-card {
            perspective: 1500px;
            min-height: 180px; /* Ensure plots have a minimum height */
            cursor: pointer;
        }
        .plot-flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.7s;
            transform-style: preserve-3d;
        }

        .plot-flip-card[data-plot="plotA"] { grid-area: plotA; }
        .plot-flip-card[data-plot="plotB"] { grid-area: plotB; }
        .plot-flip-card[data-plot="plotC"] { grid-area: plotC; }
        .plot-flip-card[data-plot="plotD"] { grid-area: plotD; }
        .plot-flip-card[data-plot="plotE"] { grid-area: plotE; }

        .plot-flip-card.is-flipped .plot-flip-card-inner {
            transform: rotateY(180deg);
        }
        .plot-flip-card-front, .plot-flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.75rem; /* 12px */
        }
        .plot-flip-card-back {
            transform: rotateY(180deg);
        }
        .plot-flip-card-front::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0.1));
            border-radius: 0.75rem;
            z-index: 1;
        }

        /* --- NEW: Hero Section Drone Animation --- */
        .hero-drone {
            position: absolute;
            color: hsl(var(--primary));
            opacity: 0.6;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            z-index: 20; /* Ensure drones are on top of other content */
        }

        #drone1 {
            top: 10%;
            animation: fly-around-1 30s ease-in-out infinite;
        }

        #drone2 {
            top: 60%;
            animation: fly-around-2 35s ease-in-out infinite;
            animation-delay: -15s;
        }

        @keyframes fly-around-1 {
            0% { transform: translate(-10vw, 0) scale(0.8) rotate(-10deg); }
            25% { transform: translate(50vw, 10vh) scale(1) rotate(5deg); }
            50% { transform: translate(110vw, 5vh) scale(0.9) rotate(10deg); }
            75% { transform: translate(40vw, -5vh) scale(0.8) rotate(-5deg); }
            100% { transform: translate(-10vw, 0) scale(0.8) rotate(-10deg); }
        }

        @keyframes fly-around-2 {
            0% { transform: translate(110vw, 0) scale(0.7) rotate(10deg); }
            25% { transform: translate(50vw, 10vh) scale(0.9) rotate(-5deg); }
            50% { transform: translate(-10vw, 15vh) scale(0.8) rotate(-10deg); }
            75% { transform: translate(45vw, 5vh) scale(0.7) rotate(5deg); }
            100% { transform: translate(110vw, 0) scale(0.7) rotate(10deg); }
        }

        /* --- NEW: AgriBot Avatar & Chat Styles --- */
        #agribot-avatar {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        #agribot-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px hsl(var(--primary-glow));
        }
        #agribot-chat-window {
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform-origin: bottom left;
        }
        #agribot-chat-window.hidden {
            opacity: 0;
            transform: scale(0.9);
            pointer-events: none;
        }
        .chat-message {
            max-width: 80%;
        }
        .user-message {
            background-color: hsl(var(--primary));
            color: white;
            align-self: flex-end;
        }
        .bot-message {
            background-color: hsl(var(--muted));
            align-self: flex-start;
        }
        .typing-indicator span {
            animation: typing-bounce 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing-bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        /* --- NEW: "Agri-Orb" Radial Menu Styles --- */
        #agri-orb-toggle {
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), box-shadow 0.3s ease;
        }
        #agri-orb-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px hsl(var(--primary-glow));
        }
        #agri-orb-toggle.active {
            transform: rotate(225deg);
        }
        .agri-orb-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 56px; /* 14 * 4 */
            height: 56px; /* 14 * 4 */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0; /* Initially hidden */
            transition: box-shadow 0.3s ease;
            color: white;
            background: hsl(var(--primary));
        }
        .agri-orb-item:hover {
            box-shadow: 0 0 20px hsl(var(--primary-glow));
            transform: scale(1.1);
        }
        .agri-orb-item .orb-label {
            position: absolute;
            left: 120%;
            font-size: 0.9rem;
            font-weight: 600;
            color: hsl(var(--foreground)); /* Text color for label */
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 12px;
            border-radius: 9999px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transform: translateX(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .agri-orb-item:hover .orb-label {
            opacity: 1;
            transform: translateX(0);
        }

        /* --- NEW: Virtual Farm Simulator Styles --- */
        .simulator-viewport {
            background-color: #a16207; /* soil color */
            background-image:
                linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            border: 8px solid #854d0e;
            border-radius: 1rem;
            padding: 1rem;
        }
        .simulator-plot {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(2rem, 1fr));
            gap: 0.5rem;
            width: 100%;
            height: 100%;
        }
        .sim-plant {
            transition: transform 0.5s ease-out, opacity 0.5s;
            transform-origin: bottom center;
            opacity: 0;
            transform: scale(0);
        }

        /* --- NEW: Command Palette Styles --- */
        #command-palette-results .active {
            background-color: hsl(var(--primary) / 0.1);
            color: hsl(var(--primary));
        }

        /* --- NEW: Tabbed Section Styles --- */
        .page-section {
            /* display: none; */ /* Hide all sections by default */
            animation: fade-in 0.5s ease-out; /* Add a fade-in effect */
            display: flex; /* Ensure sections are flex containers */
        }
        /* .page-section.active { display: flex; } */ /* No longer needed */


    </style>
</head>
<body class="min-h-screen">

    <!-- NEW: Command Palette -->
    <div id="command-palette" class="fixed inset-0 z-[100] hidden items-start justify-center bg-black/50 pt-20 backdrop-blur-sm">
        <div id="command-palette-content" class="glass-panel w-full max-w-xl rounded-2xl shadow-2xl flex flex-col overflow-hidden">
            <!-- Search Input -->
            <div class="relative border-b">
                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                <input type="text" id="command-palette-input" placeholder="Search for sections or actions..." class="w-full bg-transparent p-4 pl-12 text-lg focus:outline-none">
                <div class="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-semibold text-gray-500 border rounded-md px-2 py-1">ESC</div>
            </div>
            <!-- Results List -->
            <ul id="command-palette-results" class="max-h-96 overflow-y-auto p-2">
                <!-- Results will be populated by JS -->
            </ul>
            <!-- No Results Message -->
            <div id="command-palette-no-results" class="hidden p-8 text-center text-gray-500">
                <p>No results found.</p>
            </div>
            <!-- Footer -->
            <div class="border-t p-2 text-xs text-center text-gray-500 bg-gray-50/50">
                Press <kbd class="font-semibold">‚Üë</kbd> <kbd class="font-semibold">‚Üì</kbd> to navigate, <kbd class="font-semibold">Enter</kbd> to select, <kbd class="font-semibold">Esc</kbd> to close.
            </div>
        </div>
    </div>

    <button id="open-command-palette" class="fixed top-6 right-6 z-50 w-16 h-16 rounded-full flex items-center justify-center shadow-lg glass-panel hover:scale-110 transition-transform">
        <i data-lucide="search" class="w-7 h-7" style="color: hsl(var(--primary));"></i>
    </button>

    <!-- NEW: "Agri-Orb" Radial Menu -->
    <div id="agri-orb-menu-container" class="fixed top-6 left-6 z-50">
        <div id="agri-orb-items" class="absolute top-0 left-0">
            <a href="#home" class="agri-orb-item"><i data-lucide="home" class="w-6 h-6"></i><span class="orb-label">Home</span></a>
            <a href="#about" class="agri-orb-item"><i data-lucide="info" class="w-6 h-6"></i><span class="orb-label">About</span></a>
            <a href="#dashboard" class="agri-orb-item"><i data-lucide="layout-dashboard" class="w-6 h-6"></i><span class="orb-label">Dashboard</span></a>
            <a href="#ai-advisor" class="agri-orb-item"><i data-lucide="brain-circuit" class="w-6 h-6"></i><span class="orb-label">AI Advisor</span></a>
            <a href="#marketlink" class="agri-orb-item"><i data-lucide="line-chart" class="w-6 h-6"></i><span class="orb-label">MarketLink</span></a>
            <a href="#govt-schemes" class="agri-orb-item"><i data-lucide="landmark" class="w-6 h-6"></i><span class="orb-label">Schemes</span></a>
            <a href="#soil-monitor" class="agri-orb-item"><i data-lucide="thermometer-snowflake" class="w-6 h-6"></i><span class="orb-label">Soil Monitor</span></a>
            <a href="#learn-and-earn" class="agri-orb-item"><i data-lucide="book-open-check" class="w-6 h-6"></i><span class="orb-label">Learn & Earn</span></a>
            <a href="#agri-access" class="agri-orb-item"><i data-lucide="key-round" class="w-6 h-6"></i><span class="orb-label">Agri-Access</span></a>
        </div>
        <button id="agri-orb-toggle" class="w-16 h-16 rounded-full flex items-center justify-center shadow-lg relative" style="background: hsl(var(--primary));">
            <i data-lucide="plus" class="w-8 h-8 text-white transition-transform duration-300"></i>
        </button>
    </div>

    <!-- Animated Drones (moved to body for visibility) -->
    <i id="drone1" data-lucide="drone" class="hero-drone w-16 h-16"></i>
    <i id="drone2" data-lucide="drone" class="hero-drone w-12 h-12"></i>

    <!-- Hero Section -->
    <section id="home" class="page-section hero-bg min-h-screen items-center justify-center relative overflow-hidden">
        <div class="container mx-auto px-6 py-20 relative z-10">
            <div class="max-w-4xl mx-auto text-center fade-in text-gray-100">
                <div class="inline-block px-6 py-2 rounded-full glass-panel mb-6">
                    <span class="font-semibold text-gray-100 hero-text-shadow">üåç Hybrid AgriTech Platform</span>
                </div>
                
                <h1 class="text-5xl md:text-6xl font-bold mb-6 leading-tight hero-text-shadow">
                    Bridging the Digital Divide in <span class="text-transparent bg-clip-text bg-gradient-to-r from-[hsl(var(--accent))] to-[hsl(var(--secondary))]">Agriculture</span>
                </h1>
                
                <p id="tagline" class="font-mono text-xl mb-10 opacity-90 max-w-3xl mx-auto h-14 hero-text-shadow">
                    <!-- Text will be typed here by JS -->
                </p>
                
                <!-- NEW: Farmer Selector Dropdown (Moved from Nav) -->
                <div class="max-w-xs mx-auto mb-8">
                    <label for="farmer-selector" class="text-xs font-semibold text-gray-200 hero-text-shadow">Select a Farmer to View Dashboard</label>
                    <select id="farmer-selector" class="block w-full mt-1 p-2 border-2 border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-gray-100/80 font-semibold text-lg text-center text-gray-800">
                        <option value="farmer1">Ramesh Kumar</option>
                        <option value="farmer2">Sita Devi</option>
                        <option value="farmer3">Vijay Singh</option>
                        <option value="farmer4">Anjali Patel</option>
                        <option value="farmer5">Balwinder Singh</option>
                    </select>
                </div>

                <div class="flex gap-4 justify-center mb-12">
                    <a href="#dashboard" class="px-8 py-4 rounded-lg font-semibold transition shadow-lg hover:scale-105" style="background: hsl(var(--primary)); color: hsl(var(--background));">
                        Launch Dashboard
                    </a>
                </div>
                

                 <!-- NEW: Animated Globe -->
                <div class="flex justify-center">
                    <lord-icon
                        src="https://cdn.lordicon.com/tgnqhsfe.json"
                        trigger="loop"
                        delay="2000"
                        colors="primary:hsl(var(--primary)),secondary:hsl(var(--accent))"
                        style="width:120px;height:120px">
                    </lord-icon>
                </div>
            </div>

        </div>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboard" class="page-section py-20 min-h-screen items-center">
        <div class="container mx-auto px-6" data-animate-children>
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Farm Overview</h2>
            
            <div class="grid lg:grid-cols-3 gap-8 items-start">
                <!-- Left Side: Interactive Farm Map -->
                <div class="lg:col-span-2 glass-panel p-6 rounded-2xl">
                    <div class="farm-layout">
                        <!-- Plot A (Takes up more space) -->
                        <div class="farm-plot flat-plot" data-plot="plotA" style="grid-area: plotA;">
                            <div class="relative z-10 flex flex-col items-center justify-center text-center p-2">
                                <div class="flex items-baseline gap-2">
                                    <i data-lucide="carrot" class="w-10 h-10"></i>
                                    <p class="font-bold text-lg"></p>
                                </div>
                                <div class="mt-4 flex items-center gap-4 text-sm font-semibold">
                                    <span class="plot-metric-1 flex items-center gap-1"></span>
                                    <span class="plot-metric-2 flex items-center gap-1"></span>
                                </div>
                            </div>
                            <div class="plot-pattern"></div>
                        </div>
                        <!-- Plot B -->
                        <div class="farm-plot flat-plot" data-plot="plotB" style="grid-area: plotB;">
                            <div class="plot-pattern" style="background-image: repeating-linear-gradient(45deg, #ca8a04, #ca8a04 1px, transparent 1px, transparent 10px);"></div>
                            <div class="relative z-10 flex flex-col items-center justify-center text-center p-2">
                                <div class="flex items-baseline gap-2">
                                    <i data-lucide="barley" class="w-10 h-10"></i>
                                    <p class="font-bold text-lg"></p>
                                </div>
                                <div class="mt-4 flex items-center gap-4 text-sm font-semibold">
                                    <span class="plot-metric-1 flex items-center gap-1"></span>
                                    <span class="plot-metric-2 flex items-center gap-1"></span>
                                </div>
                            </div>
                        </div>
                        <!-- Plot C -->
                        <div class="farm-plot flat-plot" data-plot="plotC" style="grid-area: plotC;">
                            <div class="plot-pattern" style="background-image: linear-gradient(#94a3b8 1px, transparent 1px), linear-gradient(to right, #94a3b8 1px, transparent 1px);"></div>
                            <div class="relative z-10 flex flex-col items-center justify-center text-center p-2">
                                <div class="flex items-baseline gap-2">
                                    <i data-lucide="shovel" class="w-10 h-10"></i>
                                    <p class="font-bold text-lg"></p>
                                </div>
                                <div class="mt-4 flex items-center gap-4 text-sm font-semibold">
                                    <span class="plot-metric-1 flex items-center gap-1"></span>
                                    <span class="plot-metric-2 flex items-center gap-1"></span>
                                </div>
                            </div>
                        </div>
                        <!-- Plot D -->
                        <div class="farm-plot flat-plot" data-plot="plotD" style="grid-area: plotD;">
                            <div class="plot-pattern" style="background-image: repeating-conic-gradient(#84cc16 0% 25%, transparent 0% 50%); background-size: 30px 30px;"></div>
                            <div class="relative z-10 flex flex-col items-center justify-center text-center p-2">
                                <div class="flex items-baseline gap-2">
                                    <i data-lucide="seedling" class="w-10 h-10"></i>
                                    <p class="font-bold text-lg"></p>
                                </div>
                                <div class="mt-4 flex items-center gap-4 text-sm font-semibold">
                                    <span class="plot-metric-1 flex items-center gap-1"></span>
                                    <span class="plot-metric-2 flex items-center gap-1"></span>
                                </div>
                            </div>
                        </div>
                        <!-- Plot E -->
                        <div class="farm-plot flat-plot" data-plot="plotE" style="grid-area: plotE;">
                            <div class="plot-pattern" style="background-image: repeating-linear-gradient(-45deg, #d97706, #d97706 1px, transparent 1px, transparent 6px);"></div>
                            <div class="relative z-10 flex flex-col items-center justify-center text-center p-2">
                                <div class="flex items-baseline gap-2">
                                    <i data-lucide="leaf" class="w-10 h-10"></i>
                                    <p class="font-bold text-lg"></p>
                                </div>
                                <div class="mt-4 flex items-center gap-4 text-sm font-semibold">
                                    <span class="plot-metric-1 flex items-center gap-1"></span>
                                    <span class="plot-metric-2 flex items-center gap-1"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side: Info & Actions Panel -->
                <div class="space-y-8 lg:sticky top-24">
                    <!-- Field Conditions -->
                    <div class="glass-panel p-6 rounded-2xl">
                        <h3 id="plot-details-title" class="text-2xl font-bold mb-4">Overall Conditions</h3>
                        <div id="plot-details-content">
                            <!-- Default Content -->
                            <p class="text-sm text-gray-600">Click on a plot for specific details.</p>
                            <div class="mt-4 h-24 bg-gray-100 rounded-lg flex items-center justify-center">
                                <p class="text-xs text-gray-400">No plot selected</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="text-center p-3 bg-gray-100 rounded-lg">
                                <p class="text-sm opacity-70">Temperature</p>
                                <p class="text-2xl font-bold">28¬∞C</p>
                            </div>
                            <div class="text-center p-3 bg-gray-100 rounded-lg">
                                <p class="text-sm opacity-70">Humidity</p>
                                <p class="text-2xl font-bold">68%</p>
                            </div>
                        </div>
                        <h4 class="font-bold text-center text-sm opacity-70 mb-2">5-Day Forecast</h4>
                        <div id="forecast-container" class="grid grid-cols-7 gap-2 text-center">
                            <div><p class="font-bold text-xs">Today</p><i data-lucide="sun" class="w-6 h-6 mx-auto my-1 text-yellow-500"></i><p class="text-sm font-semibold">28¬∞</p></div>
                            <div><p class="font-bold text-xs">Tue</p><i data-lucide="cloud-sun" class="w-6 h-6 mx-auto my-1 text-gray-500"></i><p class="text-sm font-semibold">26¬∞</p></div>
                            <div><p class="font-bold text-xs">Wed</p><i data-lucide="cloud-rain" class="w-6 h-6 mx-auto my-1 text-blue-500"></i><p class="text-sm font-semibold">24¬∞</p></div>
                            <div><p class="font-bold text-xs">Thu</p><i data-lucide="cloud-lightning" class="w-6 h-6 mx-auto my-1 text-purple-500"></i><p class="text-sm font-semibold">25¬∞</p></div>
                            <div><p class="font-bold text-xs">Fri</p><i data-lucide="sun" class="w-6 h-6 mx-auto my-1 text-yellow-500"></i><p class="text-sm font-semibold">27¬∞</p></div>
                            <div><p class="font-bold text-xs">Sat</p><i data-lucide="sun" class="w-6 h-6 mx-auto my-1 text-yellow-500"></i><p class="text-sm font-semibold">29¬∞</p></div>
                            <div><p class="font-bold text-xs">Sun</p><i data-lucide="cloud-sun" class="w-6 h-6 mx-auto my-1 text-gray-500"></i><p class="text-sm font-semibold">28¬∞</p></div>
                        </div>
                    </div>

                    <!-- AI Recommendations -->
                    <div class="glass-panel p-6 rounded-2xl">
                        <div class="flex items-center gap-2 mb-4">
                            <i data-lucide="brain-circuit" class="w-6 h-6" style="color: hsl(var(--primary))"></i>
                            <h3 class="text-xl font-bold">AI Recommendations</h3>
                        </div>
                        <div id="recommend-skip" class="p-3 rounded-lg bg-[hsl(var(--muted))] border-2 border-[hsl(var(--border))]">
                            <div class="flex gap-3">
                                <i data-lucide="cloud-rain" class="w-6 h-6 text-blue-500 flex-shrink-0 mt-1"></i>
                                <div>
                                    <h4 id="ai-rec-title" class="font-bold text-blue-800"></h4>
                                    <p id="ai-rec-body" class="text-sm text-blue-700 mt-1"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Tasks -->
                    <div class="glass-panel p-6 rounded-2xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-2">
                                <i data-lucide="list-checks" class="w-6 h-6" style="color: hsl(var(--accent))"></i>
                                <h3 class="text-xl font-bold">Today's Tasks</h3>
                            </div>
                            <button id="add-task-btn" class="px-2 py-1 rounded-lg text-xs border hover:bg-gray-100">+ Add</button>
                        </div>
                        <div id="tasks-list" class="space-y-2">
                            <!-- Tasks will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- AI Farming Advisor Section -->
    <section id="ai-advisor" class="page-section py-20 min-h-screen items-center">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12" data-animate-children> 
                <h2 class="text-4xl font-bold mb-4">AI Farming Advisor</h2>
                <p class="text-lg opacity-70">Strategic insights for crop planning and sales</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8" data-animate-children>
                
                <!-- Current Crop Details Card -->
                <div class="glass-panel p-6 md:p-8 rounded-2xl">
                    <div class="flex items-center gap-2 mb-6">
                        <i data-lucide="sprout" class="w-8 h-8" style="color: hsl(var(--accent))"></i>
                        <div>
                            <h3 class="text-xl font-bold">Current Crop</h3>
                            <p class="text-lg font-semibold opacity-80">Tomato (Roma)</p>
                        </div>
                    </div>
                    <ul class="space-y-3 text-sm">
                        <li class="flex justify-between items-center">
                            <span class="opacity-70">Planting Date:</span>
                            <span class="font-semibold">Aug 15, 2025</span>
                        </li>
                        <li class="flex justify-between items-center">
                            <span class="opacity-70">Growth Stage:</span>
                            <span class="font-semibold px-2 py-1 bg-green-100 text-green-800 rounded">Flowering</span>
                        </li>
                        <li class="flex justify-between items-center">
                            <span class="opacity-70">Expected Harvest:</span>
                            <span class="font-semibold">Nov 20-30</span>
                        </li>
                        <li class="flex justify-between items-center">
                            <span class="opacity-70">Overall Health:</span>
                            <span class="font-semibold text-green-600">85% (Good)</span>
                        </li>
                    </ul>
                </div>

                <!-- AI Crop Suggestions Card -->
                <div class="glass-panel p-6 md:p-8 rounded-2xl">
                    <div class="flex items-center gap-3 mb-6">
                        <i data-lucide="lightbulb" class="w-8 h-8" style="color: hsl(var(--primary))"></i>
                        <h3 class="text-xl font-bold">Next Crop Suggestions</h3>
                    </div>
                    <p class="text-sm opacity-70 mb-4">Based on soil data, weather forecast, and market demand:</p>
                    <div class="space-y-3">
                        <div class="p-4 rounded-lg bg-[hsl(var(--muted))] border">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-lg">Spinach</h4>
                                <span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-200 rounded-full">High Profit</span>
                            </div>
                            <p class="text-xs opacity-80 mb-3">High demand in winter, suitable for current soil NPK levels.</p>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm border-t pt-3 mt-3">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="dollar-sign" class="w-4 h-4 text-green-600"></i>
                                    <div>
                                        <p class="text-xs opacity-70">Est. Revenue</p>
                                        <p class="font-semibold">~$1,200/acre</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="calendar-days" class="w-4 h-4 text-blue-600"></i>
                                    <div>
                                        <p class="text-xs opacity-70">Growth Time</p>
                                        <p class="font-semibold">40-55 days</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 rounded-lg bg-[hsl(var(--muted))] border">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-lg">Lettuce</h4>
                                <span class="px-2 py-1 text-xs font-semibold text-yellow-800 bg-yellow-200 rounded-full">Stable Market</span>
                            </div>
                            <p class="text-xs opacity-80 mb-3">Fast growth cycle, good for crop rotation to improve soil health.</p>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm border-t pt-3 mt-3">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="dollar-sign" class="w-4 h-4 text-green-600"></i>
                                    <div>
                                        <p class="text-xs opacity-70">Est. Revenue</p>
                                        <p class="font-semibold">~$950/acre</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="calendar-days" class="w-4 h-4 text-blue-600"></i>
                                    <div>
                                        <p class="text-xs opacity-70">Growth Time</p>
                                        <p class="font-semibold">50-70 days</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pest & Disease Detection Card -->
                <div class="glass-panel p-6 md:p-8 rounded-2xl">
                    <div class="flex items-center gap-3 mb-6">
                        <i data-lucide="bug" class="w-8 h-8 text-red-500"></i>
                        <h3 class="text-xl font-bold">Pest & Disease Detection</h3>
                    </div>
                    <!-- Container for status or preview -->
                    <div id="image-analysis-container" class="mb-4">
                        <!-- Initial Status Box -->
                        <div id="threat-status-box" class="p-4 rounded-lg bg-teal-50 border border-teal-200 text-center">
                            <p class="font-semibold text-green-800">‚úÖ No Threats Detected</p>
                            <p class="text-xs text-green-700 mt-1">Last scan: Today, 9:00 AM</p>
                        </div>
                        <!-- Image Preview (hidden by default) -->
                        <div id="image-preview-container" class="hidden text-center bg-[hsl(var(--muted))] p-2 rounded-lg">
                            <img id="image-preview" src="#" alt="Image Preview" class="rounded-lg max-h-40 mx-auto border bg-gray-100">
                            <button id="remove-image-btn" class="mt-2 text-xs text-red-600 hover:underline font-semibold">Remove Image</button>
                        </div>
                        <!-- Analysis Result (hidden by default) -->
                        <div id="analysis-result-container" class="hidden p-4 rounded-lg bg-red-50 border border-red-200">
                            <h4 class="font-bold text-red-800">Result: Fungal Blight Detected</h4>
                            <div class="text-sm text-red-700 mt-2 space-y-1">
                                <p><strong>Confidence:</strong> 92%</p>
                                <p><strong>Recommendation:</strong> Immediately apply a copper-based fungicide. Remove and destroy affected leaves to prevent spread.</p>
                            </div>
                            <p class="text-xs text-gray-500 mt-3">Analysis complete. Please consult an expert for confirmation.</p>
                        </div>
                    </div>
                    <div class="space-y-2 mb-4">
                        <p class="text-sm opacity-70">Common threats for Tomatoes:</p>
                        <ul class="text-xs list-disc list-inside opacity-80">
                            <li>Blight (Fungal)</li>
                            <li>Aphids</li>
                            <li>Whitefly</li>
                        </ul>
                    </div>
                    <input type="file" id="image-upload-input" class="hidden" accept="image/*" capture="environment">
                    <button id="upload-image-btn" class="w-full py-3 rounded-lg font-semibold border flex items-center justify-center gap-2 hover:bg-[hsl(var(--muted))] transition-colors">
                        <i id="upload-btn-icon" data-lucide="camera" class="w-4 h-4"></i>
                        Upload Image for Analysis
                    </button>
                </div>

                <!-- NEW: AI Irrigation Schedule Card -->
                <div class="glass-panel p-6 md:p-8 rounded-2xl">
                    <div class="flex items-center gap-3 mb-6">
                        <i data-lucide="droplets" class="w-8 h-8" style="color: hsl(var(--secondary))"></i>
                        <h3 class="text-xl font-bold">AI Irrigation Schedule</h3>
                    </div>
                    <p class="text-sm opacity-70 mb-4">Based on crop type, soil moisture, and 5-day weather forecast.</p>
                    <div id="irrigation-schedule-list" class="space-y-3 mb-4">
                        <!-- Schedule will be dynamically populated here -->
                        <div class="p-3 rounded-lg bg-[hsl(var(--muted))] border text-center">
                            <p class="text-sm text-gray-500">Loading schedule...</p>
                        </div>
                    </div>
                    <div class="mt-4 p-3 rounded-lg bg-yellow-50 border border-yellow-200 text-sm">
                        <p id="irrigation-insight" class="font-semibold text-sky-800">
                            <i data-lucide="lightbulb" class="inline w-4 h-4 mr-1" style="color: hsl(var(--secondary))"></i>
                            <span>Insight: Irrigating in the early morning minimizes evaporation loss.</span>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Soil Monitor Section -->
    <section id="soil-monitor" class="page-section py-20 min-h-screen items-center">
        <!-- START: Integrated Offline AI Soil Monitor -->
        <main class="container mx-auto px-6 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Left Column -->
                <div class="lg:col-span-2 space-y-8">
    
                    <!-- 2. Overview / Summary Card -->
                    <section class="glass-panel p-6 rounded-2xl">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold">Plot 2 ‚Äì Tomato Crop</h2>
                                <p class="text-sm text-gray-500">Last Sensor Reading: 10:35 AM</p>
                            </div>
                            <div class="flex items-center gap-3 p-3 rounded-lg bg-yellow-50 border border-yellow-200">
                                <i data-lucide="alert-triangle" class="w-8 h-8 status-warning"></i>
                                <div>
                                    <p class="font-semibold text-orange-800">Soil health is moderate.</p>
                                    <p class="text-sm text-orange-700">Moisture decreasing ‚Äî irrigation needed within 4 hours.</p>
                                </div>
                            </div>
                        </div>
                    </section>
    
                    <!-- 3. Live Sensor Data Display -->
                    <section class="glass-panel p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">Live Sensor Data</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left min-w-[400px] md:min-w-full">
                                <thead class="border-b">
                                    <tr>
                                        <th class="pb-2 font-semibold w-1/3">Parameter</th>
                                        <th class="pb-2 font-semibold w-1/4">Current</th>
                                        <th class="pb-2 font-semibold w-1/4">Ideal Range</th>
                                        <th class="pb-2 font-semibold w-1/6 text-right">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b">
                                        <td class="py-3 flex items-center gap-2"><i data-lucide="droplets" style="color: hsl(var(--secondary))"></i> Moisture</td>
                                        <td class="py-3 font-bold">42%</td>
                                        <td class="py-3 text-gray-600">30‚Äì60%</td>
                                        <td class="py-3 text-right status-good font-semibold">‚úÖ Normal</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-3 flex items-center gap-2"><i data-lucide="thermometer" class="text-orange-500"></i> Temperature</td>
                                        <td class="py-3 font-bold">27¬∞C</td>
                                        <td class="py-3 text-gray-600">20‚Äì35¬∞C</td>
                                        <td class="py-3 text-right status-good font-semibold">‚úÖ Normal</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-3 flex items-center gap-2"><i data-lucide="wind" class="text-gray-500"></i> Humidity</td>
                                        <td class="py-3 font-bold">68%</td>
                                        <td class="py-3 text-gray-600">40‚Äì75%</td>
                                        <td class="py-3 text-right status-good font-semibold">‚úÖ Normal</td>
                                    </tr>
                                    <tr>
                                        <td class="py-3 flex items-center gap-2"><i data-lucide="flask-conical" class="text-purple-500"></i> pH</td>
                                        <td class="py-3 font-bold">6.4</td>
                                        <td class="py-3 text-gray-600">6.0‚Äì7.5</td>
                                        <td class="py-3 text-right status-warning font-semibold">‚ö†Ô∏è Slightly Acidic</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="flex gap-4 mt-6">
                            <button id="refresh-btn" class="px-4 py-2 rounded-lg font-semibold transition-all duration-200 bg-gray-200 text-gray-800 hover:bg-gray-300 flex-1 flex items-center justify-center"><i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>Refresh Readings</button>
                            <button id="run-ai-btn" class="px-4 py-2 rounded-lg font-semibold transition-all duration-200 text-gray-100 shadow-md flex-1 flex items-center justify-center" style="background-color: hsl(var(--primary));"><i data-lucide="brain" class="w-4 h-4 mr-2" id="run-ai-btn-icon"></i><span id="run-ai-btn-text">Run AI Analysis</span></button>
                        </div>
                    </section>
    
                    <!-- 4. AI Prediction & Recommendation Card -->
                    <section id="ai-prediction-card" class="glass-panel p-6 rounded-2xl bg-green-50 border-green-200 transition-all duration-500">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-2"><i data-lucide="sparkles" style="color: hsl(var(--accent))"></i>AI Prediction & Recommendation</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <p class="text-sm font-semibold text-gray-600">Soil Condition</p>
                                    <p id="ai-soil-condition" class="text-lg font-bold">Moisture dropping rapidly</p>
                                </div>
                                <div>
                                    <p class="text-sm font-semibold text-gray-600">Predicted Time to Dryness</p>
                                    <p id="ai-time-to-dryness" class="text-lg font-bold">Approx. 3 hrs 20 min</p>
                                </div>
                                <div>
                                    <p class="text-sm font-semibold text-gray-600">AI Confidence</p>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div id="ai-confidence-bar" class="h-2.5 rounded-full" style="width: 88%; background-color: hsl(var(--primary));"></div>
                                    </div>
                                    <p id="ai-confidence-text" class="text-right font-bold" style="color: hsl(var(--primary));">88%</p>
                                </div>
                            </div>
                            <div class="bg-[hsl(var(--muted))] p-4 rounded-lg border space-y-3">
                                <h4 class="font-bold">Recommendations:</h4>
                                <div class="text-sm">
                                    <p class="font-semibold">üíß Irrigation:</p>
                                    <p id="ai-rec-irrigation">Irrigate with <strong>10‚Äì12 liters per sq. meter</strong> after sunset.</p>
                                </div>
                                <div class="text-sm">
                                    <p class="font-semibold">üåø Soil Amendment:</p>
                                    <p id="ai-rec-amendment">Add <strong>organic compost</strong> to stabilize pH.</p>
                                </div>
                            </div>
                        </div>
                    </section>
    
                    <!-- NEW: Fertilizer Recommendation Card -->
                    <section class="glass-panel p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-2"><i data-lucide="flask-conical" class="text-purple-500"></i>Fertilizer Recommendation</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Left side: Analysis -->
                            <div class="space-y-3">
                                <h4 class="font-semibold">Analysis based on current readings:</h4>
                                <ul class="text-sm space-y-2">
                                    <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-green-600 mt-1 flex-shrink-0"></i><div><strong>Nitrogen (N):</strong> Levels are moderate. A gentle boost is recommended.</div></li>
                                    <li class="flex items-start gap-2"><i data-lucide="alert-triangle" class="w-4 h-4 text-yellow-500 mt-1 flex-shrink-0"></i><div><strong>Phosphorus (P):</strong> Levels are slightly low for the flowering stage.</div></li>
                                    <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-green-600 mt-1 flex-shrink-0"></i><div><strong>Potassium (K):</strong> Levels are sufficient.</div></li>
                                    <li class="flex items-start gap-2"><i data-lucide="alert-triangle" class="w-4 h-4 text-yellow-500 mt-1 flex-shrink-0"></i><div><strong>pH Level:</strong> Slightly acidic (6.4), which can limit nutrient uptake.</div></li>
                                </ul>
                            </div>
                            <!-- Right side: Recommendation -->
                            <div class="bg-white p-4 rounded-lg border border-purple-200">
                                <h4 class="font-bold text-purple-800">Suggested Product:</h4>
                                <p class="text-lg font-bold my-1">Bone Meal & Vermicompost Mix</p>
                                <p class="text-sm text-gray-600">This organic mix will provide a slow release of Phosphorus (from bone meal) and gently raise the pH while improving soil structure (from vermicompost).</p>
                                <p class="text-xs text-gray-500 mt-3">Apply 100g per plant, mixed into the topsoil.</p>
                            </div>
                        </div>
                    </section>

                </div>
    
                <!-- Right Column -->
                <div class="lg:col-span-1 space-y-8">
    
                    <!-- 8. Alerts / Notifications Section -->
                    <section class="glass-panel p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">Alerts & Notifications</h3>
                        <div class="space-y-3 max-h-64 overflow-y-auto pr-2">
                            <div class="flex items-start gap-3 p-3 rounded-lg bg-red-50 border border-red-200">
                                <i data-lucide="alert-triangle" class="status-critical flex-shrink-0 mt-1"></i>
                                <div>
                                    <p class="font-semibold text-sm">Moisture below 30% in Plot 2.</p>
                                    <p class="text-xs text-gray-500">Today, 10:15 AM</p>
                                    <button class="text-xs font-bold text-gray-600 mt-1">Acknowledge</button>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-3 rounded-lg bg-yellow-50 border-yellow-200">
                                <i data-lucide="flask-conical" class="status-warning flex-shrink-0 mt-1"></i>
                                <div>
                                    <p class="font-semibold text-sm">pH dropping fast ‚Äî soil may become acidic.</p>
                                    <p class="text-xs text-gray-500">Today, 9:40 AM</p>
                                    <button class="text-xs font-bold text-gray-600 mt-1">Acknowledge</button>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 p-3 rounded-lg bg-gray-100 border">
                                <i data-lucide="clock" class="text-gray-500 flex-shrink-0 mt-1"></i>
                                <div>
                                    <p class="font-semibold text-sm">Irrigation overdue by 4 hours.</p>
                                    <p class="text-xs text-gray-500">Yesterday, 11:00 PM</p>
                                    <button class="text-xs font-bold text-gray-600 mt-1">Acknowledge</button>
                                </div>
                            </div>
                        </div>
                    </section>
    
                    <!-- 6. Bluetooth Data Sync Panel -->
                    <section class="glass-panel p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">Sync Data to Central Hub</h3>
                        <div class="p-4 rounded-lg bg-blue-50 border-blue-200 text-center">
                            <p class="font-semibold text-sky-800">12 unsynced entries</p>
                            <p class="text-xs text-sky-600">Last Sync: 10:45 AM, 31 Oct 2025</p>
                        </div>
                        <div class="flex gap-4 mt-4">
                            <button class="px-4 py-2 rounded-lg font-semibold transition-all duration-200 border border-gray-300 text-gray-700 hover:bg-[hsl(var(--muted))] flex-1 flex items-center justify-center"><i data-lucide="search" class="w-4 h-4 mr-2"></i>Scan</button>
                            <button class="px-4 py-2 rounded-lg font-semibold transition-all duration-200 text-gray-100 shadow-md flex-1 flex items-center justify-center" style="background-color: hsl(var(--primary));"><i data-lucide="upload-cloud" class="w-4 h-4 mr-2"></i>Send Data</button>
                        </div>
                    </section>
    
                    <!-- 7. Local Data Storage Summary -->
                    <section class="glass-panel p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4">Device & Model Info</h3>
                        <ul class="text-sm space-y-2 text-gray-700">
                            <li class="flex justify-between"><span>Local records stored:</span> <span class="font-bold">125</span></li>
                            <li class="flex justify-between"><span>Storage used:</span> <span class="font-bold">1.2 MB</span></li>
                            <li class="flex justify-between border-t pt-2 mt-2"><span>AI Model version:</span> <span class="font-bold">v2.1 ‚Äì TF Lite</span></li>
                            <li class="flex justify-between"><span>Model last updated:</span> <span class="font-bold">15 Oct 2025</span></li>
                        </ul>
                        <button class="w-full mt-4 text-red-600 border-red-300 hover:bg-red-50 px-4 py-2 rounded-lg font-semibold transition-all duration-200 border flex items-center justify-center">
                            <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>Clear Local Cache
                        </button>
                    </section>
    
                </div>
            </div>
        </main>
        <!-- END: Integrated Offline AI Soil Monitor -->
    </section>

    <!-- NEW: Virtual Farm Simulator Section -->
    <section id="farm-simulator" class="page-section py-20 min-h-screen items-center">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12" data-animate-children> 
                <h2 class="text-4xl font-bold mb-4">Virtual Farm Simulator</h2>
                <p class="text-lg opacity-70">Test strategies and see virtual outcomes before applying them in the real world.</p>
            </div>

            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <!-- Left Side: Simulation View -->
                <div class="simulator-viewport relative h-96 flex items-center justify-center" data-animate-children>
                    <div id="simulator-plot" class="simulator-plot w-full h-full">
                        <!-- Plants will be generated by JS -->
                    </div>
                    <!-- Simulation Overlay -->
                    <div id="simulation-overlay" class="absolute inset-0 bg-black/50 rounded-lg flex-col items-center justify-center text-white hidden">
                        <h3 id="simulation-day" class="text-3xl md:text-4xl font-bold">Day 0 / 90</h3>
                        <div id="event-log-container" class="mt-4 w-3/4 h-32 bg-black/30 rounded-lg p-3 overflow-y-auto text-sm">
                            <p class="font-bold mb-2">Event Log:</p>
                            <div id="event-log">
                                <!-- Events will appear here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side: Controls and Results -->
                <div class="space-y-8" data-animate-children>
                    <!-- Controls -->
                    <div class="glass-panel p-6 rounded-2xl">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold">Simulation Controls</h3>
                            <button id="simulator-help-btn" class="px-3 py-1 rounded-lg text-sm font-semibold border hover:bg-gray-100 flex items-center gap-2">
                                <i data-lucide="help-circle" class="w-4 h-4"></i> Strategy Guide
                            </button>
                        </div>
                        <div class="space-y-4">
                            <!-- NEW: Crop & Scenario Selection -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="sim-crop" class="font-semibold text-sm">Select Crop</label>
                                    <select id="sim-crop" class="w-full mt-2 p-3 rounded-lg border bg-gray-50">
                                        <option value="tomato" selected>Tomato</option>
                                        <option value="corn">Corn</option>
                                        <option value="lettuce">Lettuce</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="sim-scenario" class="font-semibold text-sm">Select Scenario</label>
                                    <select id="sim-scenario" class="w-full mt-2 p-3 rounded-lg border bg-gray-50">
                                        <option value="normal" selected>Normal Season</option>
                                        <option value="drought">Drought</option>
                                        <option value="wet">Wet Season</option>
                                        <option value="pests">Pest Outbreak</option>
                                    </select>
                                </div>
                            </div>
                            <!-- NEW: Soil & Pest Control -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="sim-soil" class="font-semibold text-sm">Soil Type</label>
                                    <select id="sim-soil" class="w-full mt-2 p-3 rounded-lg border bg-gray-50">
                                        <option value="loamy" selected>Loamy (Balanced)</option>
                                        <option value="clay">Clay (Retains Water)</option>
                                        <option value="sandy">Sandy (Drains Fast)</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="sim-pest-control" class="font-semibold text-sm">Pest Control</label>
                                    <select id="sim-pest-control" class="w-full mt-2 p-3 rounded-lg border bg-gray-50">
                                        <option value="none">None</option>
                                        <option value="organic" selected>Organic (Neem Oil)</option>
                                        <option value="chemical">Chemical Pesticide</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label for="sim-irrigation" class="font-semibold text-sm flex justify-between">Irrigation Level: <span id="sim-irrigation-value">50%</span></label>
                                <input type="range" id="sim-irrigation" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div>
                                <label for="sim-fertilizer" class="font-semibold text-sm">Fertilizer Type</label>
                                <select id="sim-fertilizer" class="w-full mt-2 p-3 rounded-lg border bg-gray-50">
                                    <option value="none">None</option>
                                    <option value="npk" selected>NPK Balanced (19-19-19)</option>
                                    <option value="nitrogen">Nitrogen Rich (Urea)</option>
                                    <option value="organic">Organic (Vermicompost)</option>
                                </select>
                            </div>
                        </div>
                        <button id="run-simulation-btn" class="w-full mt-8 py-3 rounded-lg font-semibold text-gray-100 transition shadow-lg hover:scale-105" style="background-color: hsl(var(--primary));">
                            Start Growing Season
                        </button>
                    </div>

                    <!-- Results -->
                    <div id="simulation-results" class="glass-panel p-6 rounded-2xl hidden">
                        <h3 class="text-xl font-bold mb-4">Simulation Results</h3>
                        <div class="grid grid-cols-2 gap-4 mb-4 text-center">
                            <div class="p-3 bg-[hsl(var(--muted))] rounded-lg border">
                                <p class="text-sm opacity-70">Simulated Yield</p>
                                <p id="sim-yield-output" class="text-2xl font-bold">10.2 tons/acre</p>
                            </div>
                            <div class="p-3 bg-[hsl(var(--muted))] rounded-lg border">
                                <p class="text-sm opacity-70">Net Profit</p>
                                <p id="sim-profit-output" class="text-2xl font-bold" style="color: hsl(var(--primary));">‚Çπ0</p>
                            </div>
                        </div>
                        <div class="p-4 rounded-lg bg-yellow-50 border-2 border-yellow-200 text-center">
                            <p class="text-sm opacity-70">Final Grade</p> 
                            <p id="sim-grade" class="text-4xl font-bold text-orange-700">A+</p>
                            <p id="sim-title" class="font-semibold text-orange-800">Master Farmer</p>
                        </div>
                        <div id="sim-feedback-container" class="mt-4 p-3 rounded-lg bg-blue-50 border-2 border-blue-200">
                            <h4 class="font-bold text-sky-800 flex items-center gap-2"><i data-lucide="lightbulb"></i>AI Feedback:</h4>
                            <p id="sim-feedback-text" class="text-sm text-sky-700 mt-1"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW: Virtual Farm Simulator Help Modal -->
    <div id="simulator-help-modal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/60 p-4 backdrop-blur-sm">
        <div id="simulator-help-content-wrapper" class="glass-panel p-8 rounded-2xl max-w-4xl w-full relative bg-[hsl(var(--card))] transform scale-95 opacity-0 transition-all duration-300">
            <button id="close-simulator-help-btn" class="absolute top-4 right-4 text-gray-500 hover:text-black p-2 rounded-full hover:bg-gray-200 transition-colors">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h2 class="text-2xl font-bold mb-6 text-center">Virtual Farm Strategy Guide</h2>
            <div id="simulator-help-content" class="max-h-[70vh] overflow-y-auto pr-4 space-y-6 text-gray-800">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>


    <!-- NEW: Farm Innovation Lab Section -->
    <section id="innovation-lab" class="page-section py-20 min-h-screen items-center">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12 md:mb-16" data-animate-children>
                <h2 class="text-4xl font-bold mb-4">Farm Innovation Lab</h2>
                <p class="text-lg opacity-70 max-w-2xl mx-auto">Explore the future of agriculture. Click a card to see how modern technology can revolutionize farming.</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8" data-animate-children>
                <!-- Card 1: Drone Technology -->
                <div class="innovation-card glass-panel p-8 rounded-2xl text-center cursor-pointer group" data-tech="drone">
                    <i data-lucide="drone" class="w-16 h-16 mx-auto mb-4 transition-transform duration-300 group-hover:scale-110" style="color: hsl(var(--primary));"></i>
                    <h3 class="text-xl font-bold mb-2">Drone Technology</h3>
                    <p class="text-sm opacity-80">Precision spraying, crop monitoring, and field mapping from the sky.</p>
                </div>

                <!-- Card 2: Hydroponics -->
                <div class="innovation-card glass-panel p-8 rounded-2xl text-center cursor-pointer group" data-tech="hydroponics">
                    <i data-lucide="sprout" class="w-16 h-16 mx-auto mb-4 transition-transform duration-300 group-hover:scale-110" style="color: hsl(var(--accent));"></i>
                    <h3 class="text-xl font-bold mb-2">Hydroponics</h3>
                    <p class="text-sm opacity-80">Growing plants without soil, using nutrient-rich water solutions.</p>
                </div>

                <!-- Card 3: Vertical Farming -->
                <div class="innovation-card glass-panel p-8 rounded-2xl text-center cursor-pointer group" data-tech="vertical-farming">
                    <i data-lucide="layers" class="w-16 h-16 mx-auto mb-4 transition-transform duration-300 group-hover:scale-110" style="color: hsl(var(--secondary));"></i>
                    <h3 class="text-xl font-bold mb-2">Vertical Farming</h3>
                    <p class="text-sm opacity-80">Growing crops in stacked layers to maximize space and yield.</p>
                </div>

                <!-- Card 4: IoT Sensors -->
                <div class="innovation-card glass-panel p-8 rounded-2xl text-center cursor-pointer group" data-tech="iot-sensors">
                    <i data-lucide="wifi" class="w-16 h-16 mx-auto mb-4 transition-transform duration-300 group-hover:scale-110" style="color: #3b82f6;"></i>
                    <h3 class="text-xl font-bold mb-2">IoT Sensors</h3>
                    <p class="text-sm opacity-80">Real-time data on soil moisture, nutrients, and health sent to your phone.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW: MarketLink Section -->
    <section id="marketlink" class="page-section py-20 min-h-screen items-center">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12" data-animate-children> 
                <h2 class="text-4xl font-bold mb-4">MarketLink Direct</h2>
                <p class="text-lg opacity-70">Connect with local buyers and sell your produce at the best price.</p>
            </div>

            <div class="grid lg:grid-cols-2 gap-12 items-start">
                <!-- Left Panel: Mandis & Sell Button -->
                <div class="space-y-6" data-animate-children>
                    <h3 class="text-2xl font-bold">Live Mandi Prices (Local)</h3>
                    <div id="mandi-prices-container" class="space-y-6">
                        <!-- Mandi prices will be dynamically inserted here -->
                        <p class="text-gray-500">Loading local market prices...</p>
                    </div>
                    <button id="sell-now-btn" class="w-full py-4 rounded-lg font-semibold text-gray-100 transition shadow-lg hover:scale-105" style="background: hsl(var(--primary));">
                        Sell Your Produce Now
                    </button>
                </div>

                <!-- Right Panel: AI Price Forecast -->
                <div class="glass-panel p-8 rounded-2xl" data-animate-children>
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="line-chart" class="w-8 h-8" style="color: hsl(var(--primary));"></i>
                        <h3 class="text-2xl font-bold">AI Price Forecast</h3>
                    </div>
                    <p class="text-sm opacity-70 mb-4">
                        AI prediction for <strong id="forecast-crop-name">...</strong> prices over the next 7 days based on market trends and weather data.
                    </p>
                    <div class="relative h-64" style="--chart-color: hsl(var(--primary));">
                        <canvas id="priceForecastChart"></canvas>
                    </div>
                    <div class="mt-4 p-3 rounded-lg bg-sky-50 border border-sky-200 text-sm">
                        <p id="forecast-insight" class="font-semibold text-sky-800">
                            <i data-lucide="lightbulb" class="inline w-4 h-4 mr-1"></i>
                            <span>Loading insight...</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW: Agri-Venture Hub Section -->
    <section id="agri-venture" class="page-section py-20 min-h-screen items-center">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12" data-animate-children> 
                <h2 class="text-4xl font-bold mb-4">Agri-Venture Hub</h2>
                <p class="text-lg opacity-70">Turn your farm into a thriving business.</p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8 items-start">
                <!-- Left Column: Profit Calculator -->
                <div class="lg:col-span-2 space-y-8">
                    <div class="glass-panel p-8 rounded-2xl">
                        <div class="flex items-center gap-3 mb-6">
                            <i data-lucide="calculator" class="w-8 h-8" style="color: hsl(var(--primary));"></i>
                            <h3 class="text-2xl font-bold">Profitability Calculator</h3>
                        </div>
                        
                        <!-- Calculator Inputs -->
                        <div class="grid md:grid-cols-2 gap-6 mb-8">
                            <div>
                                <label for="calc-crop" class="font-semibold text-sm mb-2 block">Select Crop</label>
                                <select id="calc-crop" class="w-full p-3 rounded-lg border bg-gray-50">
                                    <option value="tomato" selected>Tomato</option>
                                    <option value="wheat">Wheat</option>
                                    <option value="sugarcane">Sugarcane</option>
                                    <option value="cotton">Cotton</option>
                                </select>
                            </div>
                            <div>
                                <label for="calc-area" class="font-semibold text-sm mb-2 block">Enter Area (in Acres)</label>
                                <input type="number" id="calc-area" value="1" min="0.1" step="0.1" class="w-full p-3 rounded-lg border bg-gray-50">
                            </div>
                        </div>

                        <!-- Calculator Results -->
                        <div id="calc-results" class="p-6 rounded-xl bg-green-50 border-2 border-green-200 space-y-4">
                            <h4 class="text-xl font-bold text-center text-green-800 mb-4">Estimated Income Report</h4>
                            <div class="grid md:grid-cols-3 gap-4 text-center">
                                <div class="p-3 bg-white rounded-lg border">
                                    <p class="text-sm opacity-70">Est. ROI</p>
                                    <p id="calc-roi" class="text-3xl font-bold text-green-600">150%</p>
                                </div>
                                <div class="p-3 bg-white rounded-lg border">
                                    <p class="text-sm opacity-70">Break-Even Point</p>
                                    <p id="calc-breakeven" class="text-3xl font-bold text-orange-600">4 months</p>
                                </div>
                                <div class="p-3 bg-white rounded-lg border">
                                    <p class="text-sm opacity-70">Market Trend</p>
                                    <div id="calc-trend" class="flex items-center justify-center gap-1">
                                        <i data-lucide="trending-up" class="w-8 h-8 text-blue-600"></i>
                                        <span class="text-2xl font-bold text-blue-600">Upward</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-xs text-gray-600 pt-4 border-t text-center">
                                <p>Estimates are based on ideal conditions and average market rates. Actual results may vary.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Agripreneurs Showcase -->
                    <div class="glass-panel p-8 rounded-2xl">
                        <h3 class="text-2xl font-bold text-center mb-8">Inspiring Agripreneurs</h3>
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Card 1 -->
                            <div class="text-center p-4 rounded-lg bg-gray-50 border">
                                <h4 class="font-bold">Priya Sharma</h4>
                                <p class="text-xs text-gray-500 mb-2">Pune, MH</p>
                                <p class="text-xs opacity-80">Started with hydroponics, now supplies to 20+ restaurants.</p>
                            </div>
                            <!-- Card 2 -->
                            <div class="text-center p-4 rounded-lg bg-gray-50 border">
                                <h4 class="font-bold">Raj Singh</h4>
                                <p class="text-xs text-gray-500 mb-2">Ludhiana, PB</p>
                                <p class="text-xs opacity-80">Built a farm-to-table app connecting 100+ local farmers to consumers.</p>
                            </div>
                            <!-- Card 3 -->
                            <div class="text-center p-4 rounded-lg bg-gray-50 border">
                                <h4 class="font-bold">Anika Reddy</h4>
                                <p class="text-xs text-gray-500 mb-2">Guntur, AP</p>
                                <p class="text-xs opacity-80">Pioneered a subscription box for organic spices, exporting to 5 countries.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Startup Toolkit -->
                <div class="lg:sticky top-24">
                    <div class="glass-panel p-8 rounded-2xl">
                        <div class="flex items-center gap-3 mb-6">
                            <i data-lucide="rocket" class="w-8 h-8" style="color: hsl(var(--accent));"></i>
                            <h3 class="text-2xl font-bold">Agri-Startup Toolkit</h3>
                        </div>
                        <div class="space-y-4">
                            <a href="#" class="block p-4 rounded-lg bg-[hsl(var(--muted))] border hover:border-green-400 hover:bg-green-50 transition-colors">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="landmark" class="w-6 h-6 text-green-700"></i>
                                    <div>
                                        <h4 class="font-bold">Govt. Incubation Programs</h4>
                                        <p class="text-xs opacity-80">Access RKVY-RAFTAAR, NIDHI-PRAYAS, and more.</p>
                                    </div>
                                </div>
                            </a>
                            <a href="#" class="block p-4 rounded-lg bg-[hsl(var(--muted))] border hover:border-yellow-400 hover:bg-yellow-50 transition-colors">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="users" class="w-6 h-6 text-yellow-700"></i>
                                    <div>
                                        <h4 class="font-bold">FPO Formation Guide</h4>
                                        <p class="text-xs opacity-80">Step-by-step guide to forming a Farmer Producer Organisation.</p>
                                    </div>
                                </div>
                            </a>
                            <a href="#" class="block p-4 rounded-lg bg-[hsl(var(--muted))] border hover:border-blue-400 hover:bg-blue-50 transition-colors">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="dollar-sign" class="w-6 h-6 text-blue-700"></i>
                                    <div>
                                        <h4 class="font-bold">Startup Funding Options</h4>
                                        <p class="text-xs opacity-80">Explore NABARD funds, Agri-Udaan, and venture capital.</p>
                                    </div>
                                </div>
                            </a>
                            <a href="#" class="block p-4 rounded-lg bg-[hsl(var(--muted))] border hover:border-purple-400 hover:bg-purple-50 transition-colors">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="file-text" class="w-6 h-6 text-purple-700"></i>
                                    <div>
                                        <h4 class="font-bold">Business Plan Templates</h4>
                                        <p class="text-xs opacity-80">Download templates for your agri-business proposal.</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <button class="w-full mt-8 py-3 rounded-lg font-semibold text-gray-100 transition shadow-lg hover:scale-105" style="background: hsl(var(--primary));">
                            Start My Agri-Venture Plan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW: Learn & Earn Section -->
    <section id="learn-and-earn" class="page-section py-20 min-h-screen items-center">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12" data-animate-children> 
                <h2 class="text-4xl font-bold mb-4">Learn & Earn: Skill Up for Success</h2>
                <p class="text-lg opacity-70 max-w-3xl mx-auto">Connect certified agricultural skills with real-world job opportunities and increase your income.</p>
            </div>

            <!-- "Learn & Earn" Banners -->
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16" data-animate-children>
                <!-- Banner 1: Drone Operator -->
                <div class="glass-panel p-6 rounded-2xl flex flex-col items-center text-center hover:shadow-xl transition-shadow">
                    <i data-lucide="drone" class="w-16 h-16 mb-4" style="color: hsl(var(--primary));"></i>
                    <h3 class="text-xl font-bold">Drone Piloting & Data Analysis</h3>
                    <p class="text-sm opacity-80 mt-2 mb-4">Master drone operations for crop monitoring, spraying, and mapping.</p>
                    <div class="mt-auto w-full p-4 rounded-lg bg-green-50 border border-green-200">
                        <p class="text-xs font-semibold text-green-800">EARN AS:</p>
                        <p class="font-bold text-green-900">Certified Agri-Drone Operator</p>
                    </div>
                </div>
                <!-- Banner 2: Soil Testing -->
                <div class="glass-panel p-6 rounded-2xl flex flex-col items-center text-center hover:shadow-xl transition-shadow">
                    <i data-lucide="test-tube-2" class="w-16 h-16 mb-4" style="color: hsl(var(--accent));"></i>
                    <h3 class="text-xl font-bold">Advanced Soil Testing</h3>
                    <p class="text-sm opacity-80 mt-2 mb-4">Learn to analyze soil health and provide nutrient management advice.</p>
                    <div class="mt-auto w-full p-4 rounded-lg bg-yellow-50 border border-yellow-200">
                        <p class="text-xs font-semibold text-yellow-800">EARN AS:</p>
                        <p class="font-bold text-yellow-900">Soil Health Advisor</p>
                    </div>
                </div>
                <!-- Banner 3: Agri-Marketing -->
                <div class="glass-panel p-6 rounded-2xl flex flex-col items-center text-center hover:shadow-xl transition-shadow">
                    <i data-lucide="store" class="w-16 h-16 mb-4" style="color: hsl(var(--secondary));"></i>
                    <h3 class="text-xl font-bold">Digital Agri-Marketing</h3>
                    <p class="text-sm opacity-80 mt-2 mb-4">Connect directly with buyers and manage supply chains using digital tools.</p>
                    <div class="mt-auto w-full p-4 rounded-lg bg-blue-50 border border-blue-200">
                        <p class="text-xs font-semibold text-blue-800">EARN AS:</p>
                        <p class="font-bold text-blue-900">FPO Manager or Supply Chain Lead</p>
                    </div>
                </div>
            </div>

            <!-- Certified Courses & Resources -->
            <div class="grid lg:grid-cols-2 gap-12 items-start">
                <!-- Left: Certified Courses -->
                <div class="space-y-6" data-animate-children>
                    <h3 class="text-2xl font-bold">Certified Skill Courses</h3>
                    <div class="space-y-4">
                        <!-- Course 1 -->
                        <div class="glass-panel p-4 rounded-xl flex items-center gap-4">
                            <div class="p-3 bg-gray-200 rounded-lg"><i data-lucide="tractor" class="w-6 h-6 text-gray-700"></i></div>
                            <div class="flex-1">
                                <p class="font-bold">Certificate in Farm Mechanization</p>
                                <p class="text-xs opacity-70">Offered by: Krishi Vigyan Kendra (KVK)</p>
                            </div>
                            <a href="#" class="px-4 py-2 rounded-lg font-semibold text-sm border hover:bg-gray-100 transition-colors">Enroll Now</a>
                        </div>
                        <!-- Course 2 -->
                        <div class="glass-panel p-4 rounded-xl flex items-center gap-4">
                            <div class="p-3 bg-gray-200 rounded-lg"><i data-lucide="sprout" class="w-6 h-6 text-gray-700"></i></div>
                            <div class="flex-1">
                                <p class="font-bold">Organic Farming Practices</p>
                                <p class="text-xs opacity-70">Offered by: ICAR</p>
                            </div>
                            <a href="#" class="px-4 py-2 rounded-lg font-semibold text-sm border hover:bg-gray-100 transition-colors">Enroll Now</a>
                        </div>
                        <!-- Course 3 -->
                        <div class="glass-panel p-4 rounded-xl flex items-center gap-4">
                            <div class="p-3 bg-gray-200 rounded-lg"><i data-lucide="archive" class="w-6 h-6 text-gray-700"></i></div>
                            <div class="flex-1">
                                <p class="font-bold">Post-Harvest Management</p>
                                <p class="text-xs opacity-70">Offered by: FICCI</p>
                            </div>
                            <a href="#" class="px-4 py-2 rounded-lg font-semibold text-sm border hover:bg-gray-100 transition-colors">Enroll Now</a>
                        </div>
                    </div>
                </div>
                <!-- Right: Online Training -->
                <div class="glass-panel p-8 rounded-2xl" data-animate-children>
                    <h3 class="text-2xl font-bold mb-4">Free Online Training</h3>
                    <p class="text-sm opacity-70 mb-6">Start learning right away with these curated video playlists from experts.</p>
                    <div class="space-y-4">
                        <a href="#" class="block p-4 rounded-lg bg-red-50 border border-red-200 hover:bg-red-100 transition-colors"><div class="flex items-center gap-3"><i data-lucide="youtube" class="w-8 h-8 text-red-600"></i><div><p class="font-bold text-red-800">Modern Farming Techniques Playlist</p><p class="text-xs text-red-700">Watch on YouTube</p></div></div></a>
                        <a href="#" class="block p-4 rounded-lg bg-blue-50 border border-blue-200 hover:bg-blue-100 transition-colors"><div class="flex items-center gap-3"><i data-lucide="youtube" class="w-8 h-8 text-blue-600"></i><div><p class="font-bold text-blue-800">Agri-Business & Marketing Guide</p><p class="text-xs text-blue-700">Watch on YouTube</p></div></div></a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW: Agri-Access Initiative Section -->
    <section id="agri-access" class="page-section py-20 min-h-screen items-center">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12" data-animate-children> 
                <h2 class="text-4xl font-bold mb-4">Agri-Access Initiative</h2>
                <p class="text-lg opacity-70 max-w-3xl mx-auto">Start your farming journey, even without owning land. Explore innovative models for the next generation of agripreneurs.</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" data-animate-children>
                <!-- Card 1: Land Share Connect -->
                <div class="glass-panel p-8 rounded-2xl flex flex-col text-center hover:shadow-xl transition-shadow">
                    <div class="flex-grow">
                        <i data-lucide="handshake" class="w-16 h-16 mx-auto mb-4" style="color: hsl(var(--primary));"></i>
                        <h3 class="text-xl font-bold mb-2">Land Share Connect</h3>
                        <p class="text-sm opacity-80">Partner with landowners. You bring the skill and effort, they provide the land. Farm together and share the profits.</p>
                    </div>
                    <div class="mt-8 flex flex-col sm:flex-row gap-3">
                        <a href="#" class="flex-1 px-4 py-3 rounded-lg font-semibold text-sm border hover:bg-gray-100 transition-colors">Find Land</a>
                        <a href="#" class="flex-1 px-4 py-3 rounded-lg font-semibold text-sm border hover:bg-gray-100 transition-colors">List Your Land</a>
                    </div>
                </div>

                <!-- Card 2: Adopt a Plot -->
                <div class="glass-panel p-8 rounded-2xl flex flex-col text-center hover:shadow-xl transition-shadow">
                    <div class="flex-grow">
                        <i data-lucide="piggy-bank" class="w-16 h-16 mx-auto mb-4" style="color: hsl(var(--accent));"></i>
                        <h3 class="text-xl font-bold mb-2">Adopt a Plot</h3>
                        <p class="text-sm opacity-80">Invest a small amount in a real farm plot. Track its growth, see the process, and earn a share of the harvest‚Äîall virtually from your dashboard.</p>
                    </div>
                    <div class="mt-8">
                        <a href="#" class="w-full block px-4 py-3 rounded-lg font-semibold text-white transition shadow-lg hover:scale-105" style="background: hsl(var(--primary));">
                            Explore Virtual Plots
                        </a>
                    </div>
                </div>

                <!-- Card 3: Co-operative Micro-Farms -->
                <div class="glass-panel p-8 rounded-2xl flex flex-col text-center hover:shadow-xl transition-shadow">
                    <div class="flex-grow">
                        <i data-lucide="pie-chart" class="w-16 h-16 mx-auto mb-4" style="color: hsl(var(--secondary));"></i>
                        <h3 class="text-xl font-bold mb-2">Co-operative Micro-Farms</h3>
                        <p class="text-sm opacity-80">Join hands with others in your community. Crowdfund a local micro-farm, share the responsibilities, and divide the rewards as a team.</p>
                    </div>
                    <div class="mt-8">
                        <a href="#" class="w-full block px-4 py-3 rounded-lg font-semibold border hover:bg-gray-100 transition-colors">
                            Find Local Co-ops
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Government Schemes Section -->
    <section id="govt-schemes" class="page-section py-20 min-h-screen items-center">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12" data-animate-children> 
                <h2 class="text-4xl font-bold mb-4">Government Schemes & Subsidies</h2>
                <p class="text-lg opacity-70">Discover and apply for programs that can support your farm.</p>
            </div>

            <!-- NEW: Featured Scheme & Search -->
            <div class="mb-12 grid lg:grid-cols-3 gap-8 items-center" data-animate-children>
                <div class="lg:col-span-2 p-8 rounded-2xl bg-gradient-to-tr from-green-50 to-blue-50 border border-gray-200">
                    <span class="inline-block bg-yellow-300 text-yellow-800 text-xs font-bold px-3 py-1 rounded-full mb-3">FEATURED SCHEME</span>
                    <h3 class="text-2xl font-bold mb-2">PM-KISAN Scheme</h3>
                    <p class="text-gray-700 mb-4">Provides direct income support of ‚Çπ6,000 per year to all landholding farmer families, transferred in three equal installments. This scheme aims to supplement the financial needs of farmers in procuring various inputs to ensure proper crop health and appropriate yields.</p>
                    <button class="px-6 py-3 rounded-lg font-semibold text-gray-100 transition shadow-md hover:scale-105" style="background: hsl(var(--primary));">
                        Check Your Installment Status
                    </button>
                </div>
                <div class="glass-panel p-6 rounded-2xl">
                    <label for="scheme-search" class="font-bold text-lg mb-2 block">Find a Scheme</label>
                    <div class="relative">
                        <input type="text" id="scheme-search" placeholder="e.g., 'insurance', 'tractor'..." class="w-full p-3 pl-10 rounded-lg border bg-gray-50 focus:ring-2 focus:ring-green-500">
                        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Search by name, benefit, or category.</p>
                </div>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" data-animate-children>
                
                <!-- Scheme Card 1 -->
                <div class="glass-panel p-8 rounded-2xl">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="landmark" class="w-8 h-8" style="color: hsl(var(--primary))"></i>
                        <h3 class="text-xl font-bold">PM-KISAN Scheme</h3>
                    </div>
                    <p class="text-sm opacity-80 mb-4">Provides income support of ‚Çπ6,000 per year to all landholding farmer families.</p>
                    <div class="text-xs space-y-1 mb-6">
                        <p><strong class="opacity-80">Eligibility:</strong> All landholding farmers.</p>
                        <p><strong class="opacity-80">Benefit:</strong> ‚Çπ2,000 every 4 months.</p>
                    </div>
                    <button class="w-full py-3 rounded-lg font-semibold border hover:bg-[hsl(var(--muted))] transition-colors">Learn More & Apply</button>
                </div>

                <!-- Scheme Card 2 -->
                <div class="glass-panel p-8 rounded-2xl">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="tractor" class="w-8 h-8" style="color: hsl(var(--accent))"></i>
                        <h3 class="text-xl font-bold">Subsidy on Farm Equipment</h3>
                    </div>
                    <p class="text-sm opacity-80 mb-4">Get subsidies from 50% to 80% on the purchase of agricultural machinery.</p>
                    <div class="text-xs space-y-1 mb-6">
                        <p><strong class="opacity-80">Eligibility:</strong> Varies by state and equipment.</p>
                        <p><strong class="opacity-80">Benefit:</strong> Reduced cost for tractors, tillers, etc.</p>
                    </div>
                    <button class="w-full py-3 rounded-lg font-semibold border hover:bg-[hsl(var(--muted))] transition-colors">Check Eligibility</button>
                </div>

                <!-- Scheme Card 3 -->
                <div class="glass-panel p-8 rounded-2xl">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="shield-check" class="w-8 h-8" style="color: hsl(var(--accent))"></i>
                        <h3 class="text-xl font-bold">PM Fasal Bima Yojana</h3>
                    </div>
                    <p class="text-sm opacity-80 mb-4">Comprehensive crop insurance against yield losses for various crops.</p>
                    <div class="text-xs space-y-1 mb-6">
                        <p><strong class="opacity-80">Eligibility:</strong> All farmers including sharecroppers.</p>
                        <p><strong class="opacity-80">Benefit:</strong> Financial support on crop failure.</p>
                    </div>
                    <button class="w-full py-3 rounded-lg font-semibold border hover:bg-[hsl(var(--muted))] transition-colors">View Coverage Details</button>
                </div>

                <!-- Scheme Card 4 -->
                <div class="glass-panel p-8 rounded-2xl">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="file-text" class="w-8 h-8" style="color: #8b5cf6"></i>
                        <h3 class="text-xl font-bold">Soil Health Card Scheme</h3>
                    </div>
                    <p class="text-sm opacity-80 mb-4">Provides soil nutrient status and recommends fertilizer dosage for improved yields.</p>
                    <div class="text-xs space-y-1 mb-6">
                        <p><strong class="opacity-80">Eligibility:</strong> All farmers are eligible.</p>
                        <p><strong class="opacity-80">Benefit:</strong> Free soil testing and expert advice.</p>
                    </div>
                    <button class="w-full py-3 rounded-lg font-semibold border hover:bg-[hsl(var(--muted))] transition-colors">Request a Test</button>
                </div>

                <!-- Scheme Card 5 -->
                <div class="glass-panel p-8 rounded-2xl">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="droplets" class="w-8 h-8" style="color: #0ea5e9"></i>
                        <h3 class="text-xl font-bold">PM Krishi Sinchayee Yojana</h3>
                    </div>
                    <p class="text-sm opacity-80 mb-4">Promotes water conservation and efficiency through micro-irrigation systems like drips and sprinklers.</p>
                    <div class="text-xs space-y-1 mb-6">
                        <p><strong class="opacity-80">Eligibility:</strong> All farmers.</p>
                        <p><strong class="opacity-80">Benefit:</strong> Subsidy on installing irrigation systems.</p>
                    </div>
                    <button class="w-full py-3 rounded-lg font-semibold border hover:bg-[hsl(var(--muted))] transition-colors">Explore Options</button>
                </div>

                <!-- Scheme Card 6 -->
                <div class="glass-panel p-8 rounded-2xl">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="sprout" class="w-8 h-8" style="color: #16a34a"></i>
                        <h3 class="text-xl font-bold">Paramparagat Krishi Vikas Yojana</h3>
                    </div>
                    <p class="text-sm opacity-80 mb-4">Supports and promotes organic farming through the adoption of traditional methods.</p>
                    <div class="text-xs space-y-1 mb-6">
                        <p><strong class="opacity-80">Eligibility:</strong> Farmers in clusters of 50 or more.</p>
                        <p><strong class="opacity-80">Benefit:</strong> Financial aid for organic inputs & certification.</p>
                    </div>
                    <button class="w-full py-3 rounded-lg font-semibold border hover:bg-[hsl(var(--muted))] transition-colors">Join a Cluster</button>
                </div>

                <!-- Scheme Card 7 -->
                <div class="glass-panel p-8 rounded-2xl">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="credit-card" class="w-8 h-8" style="color: #f43f5e"></i>
                        <h3 class="text-xl font-bold">Kisan Credit Card (KCC)</h3>
                    </div>
                    <p class="text-sm opacity-80 mb-4">Provides farmers with timely access to credit for their cultivation and other needs.</p>
                    <div class="text-xs space-y-1 mb-6">
                        <p><strong class="opacity-80">Eligibility:</strong> All farmers, tenant farmers, oral lessees.</p>
                        <p><strong class="opacity-80">Benefit:</strong> Low-interest credit line for farm expenses.</p>
                    </div>
                    <button class="w-full py-3 rounded-lg font-semibold border hover:bg-[hsl(var(--muted))] transition-colors">Apply for KCC</button>
                </div>

            </div>
        </div>
    </section>

    <!-- IVR Helpline Section -->
    <section id="ivr-helpline" class="page-section py-16 min-h-screen items-center">
        <div class="container mx-auto px-6">
            <div class="glass-panel p-8 rounded-2xl text-center max-w-3xl mx-auto" data-animate-children>
                <div class="flex justify-center mb-4">
                     <i data-lucide="phone-call" class="w-12 h-12" style="color: hsl(var(--primary))"></i>
                </div>
                <h2 class="text-3xl font-bold mb-3">Need a Human Touch?</h2>
                <p class="text-lg opacity-80 mb-6 max-w-xl mx-auto">
                    Not happy with the AI insights? Speak to our agricultural experts now!
                </p>
                <a href="tel:+18001234567" class="inline-block px-10 py-4 rounded-lg font-semibold transition shadow-lg text-gray-100 hover:scale-105" style="background: hsl(var(--primary));">
                    üìû CALL HELPLINE
                </a>
                <div class="mt-8 pt-4 border-t border-gray-200 text-sm opacity-70">
                    <p>Our 24/7 IVR system provides instant guidance. Just dial and follow the instructions:</p>
                    <p class="mt-2 font-semibold">
                        Press 1 for Pest Control Advice <br>
                        Press 2 for Fertilizer & Nutrient Guidance <br>
                        Press 3 for Market Price Updates
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- AgriMitra Program Section -->
    <section id="about" class="page-section py-20 min-h-screen items-center">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12" data-animate-children> 
                <h2 class="text-4xl font-bold mb-4">The AgriMitra Program</h2>
                <p class="text-lg opacity-70">Empowering communities with local expertise and support.</p>
            </div>

            <!-- NEW: Button to show "How It Works" -->
            <div class="text-center mb-12">
                <button id="show-how-it-works-btn" class="px-6 py-3 rounded-lg font-semibold transition shadow-md bg-[hsl(var(--card))] border hover:bg-[hsl(var(--muted))]">
                    See How It Works
                </button>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 h-[300px] md:h-[250px]" data-animate-children>
                
                <!-- Card 1: Train Local Champions -->
                <div id="agrimitra-card" class="flip-card cursor-pointer group">
                    <div class="flip-card-inner">
                        <div class="flip-card-front glass-panel p-8 rounded-2xl text-center flex flex-col justify-center">
                            <i data-lucide="users" class="w-12 h-12 mx-auto mb-4" style="color: hsl(var(--primary))"></i>
                            <h3 class="text-xl font-bold mb-2">Train Local Champions</h3>
                            <p class="text-sm opacity-80">We train one tech-savvy youth‚Äîan 'AgriMitra'‚Äîper 10 farmers.</p>
                            <p class="text-xs font-bold text-gray-500 mt-4 opacity-0 group-hover:opacity-100 transition-opacity">Click to see details</p>
                        </div>
                        <div class="flip-card-back glass-panel p-8 rounded-2xl text-center flex flex-col justify-center items-center bg-green-50">
                            <p class="text-sm font-semibold text-teal-800 mb-2">Key Outcome:</p>
                            <p class="text-lg font-bold text-teal-900">Rural Employment & Local Expertise</p>
                            <p class="text-sm font-semibold text-teal-800 mb-2">Live Status:</p>
                            <p class="text-3xl font-bold text-teal-900">324</p>
                            <p class="text-lg font-semibold text-teal-900 -mt-1">AgriMitras Active</p>
                        </div>
                    </div>
                </div>

                <!-- Card 2: Offline Data Recording -->
                <div class="flip-card group">
                    <div class="flip-card-inner">
                        <div class="flip-card-front glass-panel p-8 rounded-2xl text-center flex flex-col justify-center">
                            <i data-lucide="tablet-smartphone" class="w-12 h-12 mx-auto mb-4" style="color: hsl(var(--accent))"></i>
                            <h3 class="text-xl font-bold mb-2">Record Data for All</h3>
                            <p class="text-sm opacity-80">The AgriMitra uses our app to record data for farmers, even completely offline.</p>
                        </div>
                        <div class="flip-card-back glass-panel p-8 rounded-2xl text-center flex flex-col justify-center items-center bg-yellow-50">
                            <p class="text-sm font-semibold text-orange-800 mb-2">Key Outcome:</p>
                            <p class="text-lg font-bold text-orange-900">100% Farmer Inclusion</p>
                            <p class="text-sm font-semibold text-orange-800 mb-2">This Week:</p>
                            <p class="text-3xl font-bold text-orange-900">15,300</p>
                            <p class="text-lg font-semibold text-orange-900 -mt-1">Farmers Synced</p>
                        </div>
                    </div>
                </div>

                <!-- Card 3: Effortless Syncing -->
                <div id="bluetooth-card" class="flip-card cursor-pointer group">
                    <div class="flip-card-inner">
                        <div class="flip-card-front glass-panel p-8 rounded-2xl text-center flex flex-col justify-center">
                            <i data-lucide="bluetooth" class="w-12 h-12 mx-auto mb-4" style="color: hsl(var(--secondary))"></i>
                            <h3 class="text-xl font-bold mb-2">Effortless Syncing</h3>
                            <p class="text-sm opacity-80">Offline data is automatically uploaded when the AgriMitra is near a sync point.</p>
                            <div id="sync-progress-container" class="mt-4 h-6 hidden">
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div id="sync-progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                                </div>
                                <p id="sync-status-text" class="text-xs font-semibold text-blue-700 mt-1"></p>
                            </div>
                        </div>
                        <div class="flip-card-back glass-panel p-8 rounded-2xl text-center flex flex-col justify-center items-center bg-blue-50">
                            <p class="text-sm font-semibold text-sky-800 mb-2">Key Outcome:</p>
                            <p class="text-lg font-bold text-sky-900">Seamless Data Flow</p>
                            <p class="text-sm font-semibold text-sky-800 mb-2">Today's Syncs:</p>
                            <p class="text-3xl font-bold text-sky-900">2,150+</p>
                            <p class="text-lg font-semibold text-sky-900 -mt-1">Data Points Uploaded</p>
                        </div>
                    </div>
                </div>

                <!-- Card 4: Bridge the Gap -->
                <div class="flip-card group">
                    <div class="flip-card-inner">
                        <div class="flip-card-front glass-panel p-8 rounded-2xl text-center flex flex-col justify-center">
                            <i data-lucide="presentation" class="w-12 h-12 mx-auto mb-4" style="color: hsl(var(--primary-glow))"></i>
                            <h3 class="text-xl font-bold mb-2">Bridge the Knowledge Gap</h3>
                            <p class="text-sm opacity-80">The AgriMitra explains AI-generated reports and advice to each farmer in person.</p>
                        </div>
                        <div class="flip-card-back glass-panel p-8 rounded-2xl text-center flex flex-col justify-center items-center bg-purple-50">
                            <p class="text-sm font-semibold text-purple-800 mb-2">Key Outcome:</p>
                            <p class="text-lg font-bold text-purple-900">Actionable Insights for All</p>
                        <div class="flip-card-back glass-panel p-8 rounded-2xl text-center flex flex-col justify-center items-center bg-purple-50">                            
                            <p class="text-sm font-semibold text-purple-800 mb-2">Impact:</p>
                            <p class="text-3xl font-bold text-purple-900">~25%</p>
                            <p class="text-lg font-semibold text-purple-900 -mt-1">Increase in Yield</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-12 border-t" style="background: hsl(var(--muted));">
        <div class="container mx-auto px-6 text-center">
            <div class="flex items-center justify-center gap-3 mb-4">
                <svg class="w-8 h-8" style="color: hsl(var(--primary))" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="text-2xl font-bold" style="color: hsl(var(--primary))">Agrilogy</span>
            </div>
            <p class="opacity-70 mb-6">Bridging the Digital Divide in Agriculture</p>
            <p class="text-sm opacity-60">¬© 2025 Agrilogy. Empowering farmers with technology.</p>
        </div>
    </footer>

    <!-- NEW: Innovation Lab Modal -->
    <div id="innovation-lab-modal" class="fixed inset-0 z-[60] hidden items-center justify-center bg-black/60 p-4 backdrop-blur-sm">
        <div id="innovation-lab-content" class="glass-panel p-8 rounded-2xl max-w-4xl w-full relative bg-[hsl(var(--card))] transform scale-95 opacity-0">
            <button id="close-innovation-lab-btn" class="absolute top-4 right-4 text-gray-500 hover:text-black p-2 rounded-full hover:bg-gray-200 transition-colors">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <!-- Left: Visual & Description -->
                <div>
                    <h2 id="lab-modal-title" class="text-3xl font-bold mb-4">Technology Name</h2>
                    <div id="lab-modal-visual" class="h-48 bg-gray-200 rounded-lg mb-4 flex items-center justify-center">
                        <!-- Animation or image will go here -->
                    </div>
                    <p id="lab-modal-description" class="text-sm opacity-80">Description of the technology and its benefits for modern farming.</p>
                </div>

                <!-- Right: Cost-Benefit Analysis -->
                <div>
                    <h3 class="text-xl font-bold mb-4 text-center">Cost vs. Benefit Analysis</h3>
                    <div class="relative h-64">
                        <canvas id="lab-modal-chart"></canvas>
                    </div>
                    <div class="mt-4 p-3 rounded-lg bg-green-50 border border-green-200 text-sm">
                        <p id="lab-modal-insight" class="font-semibold text-green-800">
                            <i data-lucide="trending-up" class="inline w-4 h-4 mr-1"></i>
                            <span>Insight on profitability.</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: AgriMitra Modal -->
    <div id="agrimitra-modal" class="fixed inset-0 z-[60] hidden items-center justify-center bg-black bg-opacity-60 p-4">
        <div id="agrimitra-content" class="glass-panel p-8 rounded-2xl max-w-4xl w-full relative bg-[hsl(var(--card))]">
            <button id="close-agrimitra-btn" class="absolute top-4 right-4 text-gray-500 hover:text-black">&times;</button>
            
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold mb-2">AgriMitra Network Overview</h2>
                <p class="text-lg opacity-70">Hubli-Dharwad Region Coverage</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8 items-start">
                <!-- Left: Map -->
                <div class="rounded-xl overflow-hidden border">
                    <img src="https://i.imgur.com/8X5gE7p.png" alt="Map of AgriMitra coverage in Hubli region" class="w-full h-auto object-cover">
                </div>

                <!-- Right: Reports -->
                <div class="space-y-4">
                    <h3 class="text-xl font-bold">Example Reports Uploaded</h3>
                    <!-- Report 1 -->
                    <div class="p-4 rounded-lg bg-[hsl(var(--muted))] border">
                        <p class="font-bold text-sm">Soil Health Report - Plot B</p>
                        <p class="text-xs text-gray-600">Uploaded by: AM-102 (Sunil)</p>
                        <p class="text-xs text-gray-500">Status: <span class="text-green-600 font-semibold">Processed</span></p>
                    </div>
                    <!-- Report 2 -->
                    <div class="p-4 rounded-lg bg-[hsl(var(--muted))] border">
                        <p class="font-bold text-sm">Pest Sighting - Plot A (Tomato)</p>
                        <p class="text-xs text-gray-600">Uploaded by: AM-105 (Priya)</p>
                        <p class="text-xs text-gray-500">Status: <span class="text-yellow-600 font-semibold">AI Analysis Pending</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Sell Now Modal -->
    <div id="sell-now-modal" class="fixed inset-0 z-[60] hidden items-center justify-center bg-black bg-opacity-60 p-4">
        <div id="sell-now-content" class="glass-panel p-8 rounded-2xl max-w-lg w-full relative bg-[hsl(var(--card))]">
            <button id="close-sell-now-btn" class="absolute top-4 right-4 text-gray-500 hover:text-black">&times;</button>
            <h2 class="text-2xl font-bold mb-6 text-center">Create New Listing</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="font-semibold text-sm mb-1 block">Select Crop</label>
                    <select class="w-full p-3 rounded-lg border bg-gray-50">
                        <option>Tomato</option>
                        <option>Wheat</option>
                        <option>Corn</option>
                        <option>Potatoes</option>
                    </select>
                </div>
                <div>
                    <label class="font-semibold text-sm mb-1 block">Enter Quantity (in kg)</label>
                    <input type="number" placeholder="e.g., 500" class="w-full p-3 rounded-lg border bg-gray-50">
                </div>
                <div>
                    <label class="font-semibold text-sm mb-1 block">Upload Produce Photo</label>
                    <div id="sell-image-preview-container" class="hidden items-center gap-4 mb-2">
                        <img id="sell-image-preview" src="#" alt="Preview" class="w-16 h-16 rounded-lg object-cover border">
                        <button id="sell-remove-image-btn" class="text-xs text-red-600 hover:underline font-semibold">Remove</button>
                    </div>
                    <input type="file" id="sell-image-upload" class="hidden" accept="image/*">
                    <button id="sell-upload-btn" class="w-full p-3 rounded-lg border-2 border-dashed flex items-center justify-center gap-2 text-gray-500 hover:bg-gray-50">
                        <i data-lucide="image-plus" class="w-5 h-5"></i> Click to Upload
                    </button>
                </div>
                <button class="w-full py-3 mt-4 rounded-lg font-semibold text-gray-100" style="background: hsl(var(--primary));">Post Listing to MarketLink</button>
            </div>
        </div>
    </div>

    <!-- NEW: How It Works Modal -->
    <div id="how-it-works-modal" class="fixed inset-0 z-[60] hidden items-center justify-center bg-black bg-opacity-60 p-4">
        <div id="how-it-works-content" class="glass-panel p-8 rounded-2xl max-w-4xl w-full relative bg-[hsl(var(--card))]">
            <button id="close-how-it-works-btn" class="absolute top-4 right-4 text-gray-500 hover:text-black">&times;</button>
            
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold mb-4">How Agrilogy Works</h2>
                <p class="text-lg opacity-70">An intelligent, step-by-step process to optimize your water usage.</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 items-start">
                <!-- Step 1: Farmer & Weather Inputs -->
                <div class="glass-panel p-6 rounded-xl">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="database" class="w-8 h-8" style="color: hsl(var(--primary))"></i>
                        <h3 class="text-xl font-bold">1. Gather Data</h3>
                    </div>
                    <p class="text-sm opacity-80">The system collects farmer inputs (crop type, area) and fetches real-time weather data.</p>
                </div>
                <!-- Step 2: AI Prediction -->
                <div class="glass-panel p-6 rounded-xl">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="brain-circuit" class="w-8 h-8" style="color: hsl(var(--accent))"></i>
                        <h3 class="text-xl font-bold">2. AI Analysis</h3>
                    </div>
                    <p class="text-sm opacity-80">Our AI predicts soil moisture and calculates the precise water requirement.</p>
                </div>
                <!-- Step 3: Context Check -->
                <div class="glass-panel p-6 rounded-xl">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="cloud-rain" class="w-8 h-8" style="color: hsl(var(--secondary))"></i>
                        <h3 class="text-xl font-bold">3. Context Check</h3>
                    </div>
                    <p class="text-sm opacity-80">It checks for rainfall probability and recent irrigation history.</p>
                </div>
                <!-- Step 4: Conditional Logic & Alerts -->
                <div class="glass-panel p-6 rounded-xl lg:col-span-3">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="git-branch" class="w-8 h-8" style="color: #a855f7"></i>
                        <h3 class="text-xl font-bold">4. Smart Alerts</h3>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4 mt-4 text-sm">
                        <div class="p-4 rounded-lg bg-green-50 border border-green-200"><p class="font-bold text-green-800 mb-2">IF Water Needed:</p><p class="text-green-700">An alert is sent with the exact amount of water required.</p></div>
                        <div class="p-4 rounded-lg bg-blue-50 border border-blue-200"><p class="font-bold text-blue-800 mb-2">IF Water NOT Needed:</p><p class="text-blue-700">An alert is sent to save water due to expected rain.</p></div>
                    </div>
                </div>
                <!-- Step 5: Reporting -->
                <div class="glass-panel p-6 rounded-xl lg:col-start-2">
                    <div class="flex items-center gap-3 mb-4"><i data-lucide="bar-chart-3" class="w-8 h-8" style="color: hsl(var(--primary-glow))"></i><h3 class="text-xl font-bold">5. Generate Reports</h3></div>
                    <p class="text-sm opacity-80">All data is saved to generate insightful reports on water usage and savings.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Side Grow Animation SVG -->
    <div id="side-plant-container" class="fixed bottom-0 left-4 z-20 w-16 h-96 pointer-events-none">
        <svg id="side-plant" viewBox="0 0 100 400" class="w-full h-full" preserveAspectRatio="xMidYMax meet">
            <defs>
                <mask id="stem-mask">
                    <!-- This rectangle will grow upwards to reveal the stem -->
                    <rect id="stem-mask-rect" x="48" y="400" width="4" height="400" fill="white" />
                </mask>
            </defs>
            <!-- Stem -->
            <path d="M50,400 C50,300 50,200 50,0" stroke="hsl(var(--primary))" stroke-width="4" fill="none" mask="url(#stem-mask)" />
            
            <!-- Leaves (initially hidden) -->
            <g id="leaf1" transform="translate(50, 300) scale(0.8)"><path d="M0,0 C15,-15 35,-15 40,-30 C45,-15 25,-15 0,0" fill="hsl(var(--primary-glow))" /></g>
            <g id="leaf2" transform="translate(50, 220) scale(-0.9, 0.9)"><path d="M0,0 C15,-15 35,-15 40,-30 C45,-15 25,-15 0,0" fill="hsl(var(--primary-glow))" /></g>
            <g id="leaf3" transform="translate(50, 140) scale(1)"><path d="M0,0 C15,-15 35,-15 40,-30 C45,-15 25,-15 0,0" fill="hsl(var(--primary-glow))" /></g>
            <g id="leaf4" transform="translate(50, 60) scale(-1.1, 1.1)"><path d="M0,0 C15,-15 35,-15 40,-30 C45,-15 25,-15 0,0" fill="hsl(var(--primary-glow))" /></g>
        </svg>
    </div>

    <!-- NEW: Decorative Corner Vines -->
    <div id="corner-vines-container" class="fixed top-0 left-0 w-full h-full z-20 pointer-events-none opacity-30">
        <!-- Top-left vine -->
        <svg id="vine-tl" class="absolute top-0 left-0 w-48 h-48" viewBox="0 0 200 200">
            <path d="M1,1 C40,60 20,120 80,150 S150,120 180,199" stroke="#a7c957" stroke-width="2" fill="none" />
        </svg>
        <!-- Top-right vine -->
        <svg id="vine-tr" class="absolute top-0 right-0 w-48 h-48" viewBox="0 0 200 200">
            <path d="M199,1 C160,60 180,120 120,150 S50,120 20,199" stroke="#a7c957" stroke-width="2" fill="none" />
        </svg>
    </div>

    <!-- NEW: AgriBot AI Partner -->
    <div id="agribot-container" class="fixed bottom-6 left-6 z-40">
        <!-- Chat Window -->
        <div id="agribot-chat-window" class="hidden absolute bottom-20 left-0 w-80 md:w-96 h-[500px] glass-panel rounded-2xl flex flex-col shadow-2xl">
            <!-- Header -->
            <div class="flex items-center justify-between p-4 border-b">
                <div class="flex items-center gap-3">
                    <i data-lucide="bot" class="w-8 h-8" style="color: hsl(var(--primary))"></i>
                    <div>
                        <h3 class="font-bold text-lg">AgriBot</h3>
                        <p class="text-xs font-semibold" style="color: hsl(var(--accent));">‚óè Online</p>
                    </div>
                </div>
                <button id="close-agribot-btn" class="p-1 rounded-full hover:bg-gray-200">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <!-- Message Area -->
            <div id="agribot-messages" class="flex-1 p-4 space-y-4 overflow-y-auto">
                <!-- Messages will be appended here -->
            </div>
            <!-- Input Form -->
            <form id="agribot-form" class="p-4 border-t">
                <div class="relative">
                    <input type="text" id="agribot-input" placeholder="Ask me anything..." class="w-full p-3 pr-12 rounded-lg border bg-gray-50 focus:ring-2 focus:ring-green-500" autocomplete="off">
                    <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-full text-gray-100" style="background-color: hsl(var(--primary));">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
            </form>
        </div>

        <!-- Avatar Button -->
        <button id="agribot-avatar" class="w-16 h-16 rounded-full flex items-center justify-center shadow-lg" style="background: hsl(var(--primary));">
            <!-- NEW: Custom SVG for eye-tracking bot -->
            <svg id="agribot-svg" viewBox="0 0 24 24" class="w-9 h-9 text-gray-100" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 8V4H8"/>
                <rect width="16" height="12" x="4" y="8" rx="2"/>
                <path d="M2 14h2"/>
                <path d="M20 14h2"/>
                <!-- Eyes: two circles that will be the pupils -->
                <circle id="agribot-eye-left" cx="9" cy="14" r="1" fill="currentColor" stroke="none"/>
                <circle id="agribot-eye-right" cx="15" cy="14" r="1" fill="currentColor" stroke="none"/>
            </svg>
        </button>
    </div>

    <!-- NEW: Stage-based Evolution Plant -->
    <div id="evolution-plant-container" class="fixed bottom-4 right-4 z-30 w-24 h-24 pointer-events-none">
        <svg id="evolution-plant" viewBox="0 0 100 100">
            <!-- Stage 1: Seed -->
            <g id="evo-seed" style="--seed-color: hsl(var(--accent));">
                <ellipse cx="50" cy="85" rx="10" ry="6" fill="#a16207"/>
            </g>
            <!-- Stage 2: Sprout -->
            <g id="evo-sprout" class="opacity-0" style="--stem-color: hsl(var(--primary)); --leaf-color: hsl(var(--primary-glow));"><path d="M50,85 C40,70 60,55 50,40" stroke="var(--stem-color)" stroke-width="4" fill="none"/><path d="M50,60 C60,55 65,45 70,50" fill="var(--leaf-color)"/><path d="M50,60 C40,55 35,45 30,50" fill="var(--leaf-color)"/></g>
            <!-- Stage 3: Flower -->
            <g id="evo-flower" class="opacity-0" style="--stem-color: hsl(var(--primary)); --petal-color: hsl(var(--accent));"><path d="M50,85 C45,65 55,50 50,25" stroke="var(--stem-color)" stroke-width="4" fill="none"/><circle cx="50" cy="22" r="8" fill="#a16207"/><path d="M50,22 l15,5 l-10,12 z" fill="var(--petal-color)"/><path d="M50,22 l-15,5 l10,12 z" fill="var(--petal-color)" transform="scale(-1, 1) translate(-100, 0)"/><path d="M50,22 l0,18 l-12,-10 z" fill="var(--petal-color)" transform="rotate(72, 50, 22)"/><path d="M50,22 l0,18 l12,-10 z" fill="var(--petal-color)" transform="rotate(-72, 50, 22)"/></g>
            <!-- Stage 4: Fruit -->
            <g id="evo-fruit" class="opacity-0"><path d="M50,85 C45,65 55,50 50,25" stroke="#588157" stroke-width="4" fill="none"/><circle cx="50" cy="35" r="15" fill="#d00000"/><path d="M50,20 Q55,25 60,20 L50,25 Z" fill="#3a5a40"/></g>
        </svg>
    </div>

    <script>
    (function() { // <-- Start of IIFE
        // --- NEW: Scroll to top on page load ---

        window.addEventListener('load', () => {
            // Use setTimeout to ensure it runs after any other potential scripts
            // that might affect scroll position.
            setTimeout(() => window.scrollTo(0, 0), 0);
        });

        // --- NEW: More Intelligent AgriBot Response Logic ---
        window.getBotResponse = (userInput) => {
            const lowerInput = userInput.toLowerCase();
            const currentFarmerId = document.getElementById('farmer-selector')?.value || 'farmer1';
            const farmer = farmersData[currentFarmerId];
            const regionData = mandiData[farmer.region];

            // Helper to find a crop name in the input
            const findCropInInput = (input) => {
                const knownCrops = ['tomato', 'wheat', 'corn', 'potato', 'sugarcane', 'cotton', 'mustard', 'chickpea', 'paddy', 'groundnut'];
                for (const crop of knownCrops) {
                    if (input.includes(crop)) return crop;
                }
                return null;
            };

            // 1. Intent: Get Market Price
            if (lowerInput.includes('price') || lowerInput.includes('market') || lowerInput.includes('mandi') || lowerInput.includes('rate')) {
                const cropName = findCropInInput(lowerInput);
                if (cropName) {
                    const capitalizedCrop = cropName.charAt(0).toUpperCase() + cropName.slice(1);
                    let priceFound = false;
                    let response = `Checking prices for ${capitalizedCrop} in ${farmer.region}...\n\n`;

                    regionData.mandis.forEach(mandi => {
                        if (mandi.prices[capitalizedCrop]) {
                            priceFound = true;
                            response += `- ${mandi.name}: ‚Çπ${mandi.prices[capitalizedCrop].toLocaleString('en-IN')} /qtl\n`;
                        }
                    });

                    if (priceFound) {
                        response += `\nCheck the MarketLink section for more details and AI price forecasts.`;
                        return response;
                    } else {
                        return `I'm sorry, I couldn't find market data for ${capitalizedCrop} in your region's mandis.`;
                    }
                }
                return `Which crop's price are you interested in? For example, try "What is the price of ${regionData.forecastCrop}?"`;
            }

            // 2. Intent: Get Weather Forecast
            if (lowerInput.includes('weather') || lowerInput.includes('forecast') || lowerInput.includes('rain') || lowerInput.includes('temperature')) {
                const forecastContainer = document.getElementById('forecast-container');
                const forecastItems = forecastContainer.querySelectorAll('div');
                let response = "Here is the 5-day forecast:\n\n";
                forecastItems.forEach(item => {
                    const day = item.querySelector('p:first-child').textContent;
                    const temp = item.querySelector('p:last-child').textContent;
                    response += `- ${day}: ${temp}\n`;
                });
                return response;
            }

            // 3. Intent: Analyze Farm/Crop
            if (lowerInput.includes('analyze') || lowerInput.includes('report') || lowerInput.includes('status') || lowerInput.includes('how is my farm')) {
                // Check for specific plot
                const plotMatch = lowerInput.match(/plot\s*([a-e])/);
                if (plotMatch) {
                    const plotId = `plot${plotMatch[1].toUpperCase()}`;
                    const plot = farmer.plots[plotId];
                    if (plot) {
                        // Extract details from the HTML string for a cleaner response
                        const healthMatch = plot.details.match(/Health.*?(\d+%)/);
                        const moistureMatch = plot.details.match(/Moisture.*?(\d+%)/);
                        const health = healthMatch ? healthMatch[1] : 'N/A';
                        const moisture = moistureMatch ? moistureMatch[1] : 'N/A';
                        return `Status for ${plot.name}:\n- Health: ${health}\n- Moisture: ${moisture}`;
                    }
                }
                // General analysis
                const health = farmer.currentCrop.health;
                const aiRec = document.getElementById('ai-rec-body').textContent;
                return `Overall farm analysis for ${farmer.name}:\n\nThe current main crop, ${farmer.currentCrop.name}, has an overall health of ${health}.\n\nThe current top AI recommendation is: "${aiRec}"`;
            }

            // 4. Intent: Government Schemes
            if (lowerInput.includes('scheme') || lowerInput.includes('subsidy') || lowerInput.includes('government')) {
                return "There are several government schemes available, like PM-KISAN for income support and PM Fasal Bima Yojana for crop insurance. You can find more details and search for specific schemes in the 'Government Schemes' section.";
            }

            // 5. Basic conversational intents
            if (lowerInput.includes('hello') || lowerInput.includes('hi')) {
                return `Hello, ${farmer.name}! How can I assist with your farm today?`;
            }
            if (lowerInput.includes('thank')) {
                return "You're welcome! Is there anything else I can help you with?";
            }

            // Default fallback
            return "I'm sorry, I'm not sure how to help with that. You can ask me about:\n- Crop status (e.g., 'analyze my farm')\n- Market prices (e.g., 'price of wheat')\n- The weather forecast\n- Government schemes";
        };

        // --- NEW: Global Chart.js Configuration for Visual Appeal ---
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof Chart !== 'undefined') {
                Chart.defaults.font.family = "'Poppins', sans-serif";
                Chart.defaults.color = 'hsl(var(--foreground) / 0.6)';
                Chart.defaults.borderColor = 'hsl(var(--foreground) / 0.1)';

                // Custom plugin to add a drop shadow to line charts
                const lineShadowPlugin = {
                    id: 'lineShadow',
                    beforeDraw: (chart) => {
                        if (chart.config.type === 'line') {
                            const ctx = chart.ctx;
                            ctx.save();
                            ctx.shadowColor = 'rgba(0, 0, 0, 0.15)';
                            ctx.shadowBlur = 10;
                            ctx.shadowOffsetX = 0;
                            ctx.shadowOffsetY = 5;
                        }
                    },
                    afterDraw: (chart) => {
                        if (chart.config.type === 'line') {
                            chart.ctx.restore();
                        }
                    }
                };
                Chart.register(lineShadowPlugin);
            }
        });

        // --- NEW: "Agri-Orb" Radial Menu Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            gsap.registerPlugin(MotionPathPlugin); // <-- Register the plugin here

            const toggleBtn = document.getElementById('agri-orb-toggle');
            const menuItems = gsap.utils.toArray('.agri-orb-item');
            let menuOpen = false;

            // Add learn and earn to the menu
            const learnAndEarnItem = `<a href="#learn-and-earn" class="agri-orb-item"><i data-lucide="book-open-check" class="w-6 h-6"></i><span class="orb-label">Learn & Earn</span></a>`;
            document.getElementById('agri-orb-items').insertAdjacentHTML('beforeend', learnAndEarnItem);

            // Add agri-access to the menu
            const agriAccessItem = `<a href="#agri-access" class="agri-orb-item"><i data-lucide="key-round" class="w-6 h-6"></i><span class="orb-label">Agri-Access</span></a>`;
            document.getElementById('agri-orb-items').insertAdjacentHTML('beforeend', agriAccessItem);

            // Add innovation lab to the menu
            const innovationLabItem = `<a href="#innovation-lab" class="agri-orb-item"><i data-lucide="flask-conical" class="w-6 h-6"></i><span class="orb-label">Innovation Lab</span></a>`;
            document.getElementById('agri-orb-items').insertAdjacentHTML('beforeend', innovationLabItem);

            // Set initial state: invisible, scaled down, and shifted to the left
            gsap.set(menuItems, { scale: 0, autoAlpha: 0, x: -40 });

            const openMenu = () => {
                menuOpen = true;
                toggleBtn.classList.add('active');
                gsap.to(menuItems, {
                    duration: 0.5,
                    x: 0, // Animate back to original horizontal position
                    scale: 1,
                    autoAlpha: 1,
                    pointerEvents: 'auto',
                    stagger: 0.075,
                    ease: 'power3.out',
                    // Animate each item to a new y position
                    y: (index) => {
                        // The toggle button is 64px (h-16).
                        // Each item is 56px (h-14).
                        // We'll space them out by 60px.
                        return 64 + index * 60;
                    }
                });
            };

            const closeMenu = () => {
                menuOpen = false;
                toggleBtn.classList.remove('active');
                gsap.to(menuItems, {
                    duration: 0.3,
                    scale: 0,
                    autoAlpha: 0,
                    x: -20, // Move slightly to the left on close for a nice effect
                    pointerEvents: 'none',
                    stagger: {
                        each: 0.05,
                        from: "end" // Close from the bottom up
                    },
                    ease: 'power3.in'
                });
            };

            toggleBtn.addEventListener('click', () => menuOpen ? closeMenu() : openMenu());
        });

        // Smooth scroll for anchor links
// --- MODIFIED: Section Toggling Logic ---
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);

                // Just scroll to the section smoothly
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // --- NEW: GSAP Scroll-triggered animations ---
        document.addEventListener('DOMContentLoaded', () => {
            gsap.registerPlugin(ScrollTrigger);
            const containers = gsap.utils.toArray('[data-animate-children]');

            containers.forEach(container => {
                const cards = container.children;
                
                gsap.set(cards, { autoAlpha: 0, y: 50 });

                ScrollTrigger.create({
                    trigger: container,
                    start: 'top 80%',
                    once: true,
                    onEnter: () => {
                        gsap.to(cards, {
                            autoAlpha: 1,
                            y: 0,
                            duration: 0.8,
                            stagger: 0.15,
                            ease: 'power3.out'
                        });
                    }
                });
            });

            // --- Side Plant Grow Animation ---
            const plantTimeline = gsap.timeline({
                scrollTrigger: {
                    trigger: document.body,
                    start: "top top",
                    end: "bottom bottom",
                    scrub: 2.5 // SLOWER & SMOOTHER: Increased from 2 to 2.5
                }
            });

            // Set initial state of leaves
            gsap.set(["#leaf1", "#leaf2", "#leaf3", "#leaf4"], {
                autoAlpha: 0,
                scale: 0,
                transformOrigin: "0% 0%",
                rotation: -20 // Add initial rotation
            });

            // Animate the stem growing
            plantTimeline.to("#stem-mask-rect", { y: 0, duration: 10 }, 0);

            // Animate leaves appearing at different scroll points
            // MORE IMPRESSIVE: Added rotation and a "back.out" ease for a slight overshoot effect
            plantTimeline.to("#leaf1", { autoAlpha: 1, scale: 0.8, rotation: 0, duration: 2, ease: "back.out(1.7)" }, 2);
            plantTimeline.to("#leaf2", { autoAlpha: 1, scale: 0.9, rotation: 0, duration: 2, ease: "back.out(1.7)" }, 4);
            plantTimeline.to("#leaf3", { autoAlpha: 1, scale: 1, rotation: 0, duration: 2, ease: "back.out(1.7)" }, 6);
            plantTimeline.to("#leaf4", { autoAlpha: 1, scale: 1.1, rotation: 0, duration: 2, ease: "back.out(1.7)" }, 8);

            // --- NEW: Decorative Vines Animation ---
            const vines = gsap.utils.toArray(["#vine-tl path", "#vine-tr path"]);
            vines.forEach(vine => {
                const length = vine.getTotalLength();
                gsap.set(vine, { strokeDasharray: length, strokeDashoffset: length });
                gsap.to(vine, {
                    strokeDashoffset: 0,
                    duration: 3,
                    ease: "power2.inOut",
                    scrollTrigger: {
                        trigger: document.body,
                        start: "top top",
                        end: "bottom bottom",
                        scrub: 3.5 // SLOWER & SMOOTHER: Increased from 3
                    }
                });
            });

            // --- NEW: Stage-based Plant Evolution ---
            const evoTimeline = gsap.timeline({
                scrollTrigger: {
                    trigger: document.body,
                    start: "top top",
                    end: "bottom bottom",
                    scrub: 2 // SLOWER: Increased from 1.5
                }
            });

            // Seed -> Sprout (triggered by "How It Works" section)
            evoTimeline.to("#evo-seed", { autoAlpha: 0, duration: 1 }, 0.1)
                       .to("#evo-sprout", { autoAlpha: 1, duration: 1 }, 0.1);
            // Sprout -> Flower (triggered by "Dashboard" section)
            evoTimeline.to("#evo-sprout", { autoAlpha: 0, duration: 1 }, 0.3)
                       .to("#evo-flower", { autoAlpha: 1, duration: 1 }, 0.3);
            // Flower -> Fruit (triggered by "AI Advisor" section)
            evoTimeline.to("#evo-flower", { autoAlpha: 0, duration: 1 }, 0.5)
                       .to("#evo-fruit", { autoAlpha: 1, duration: 1 }, 0.5);

            // --- NEW: How It Works Modal Logic ---
            const showBtn = document.getElementById('show-how-it-works-btn');
            const closeBtn = document.getElementById('close-how-it-works-btn');
            const modal = document.getElementById('how-it-works-modal');

            if (showBtn && closeBtn && modal) {
                showBtn.addEventListener('click', () => {
                    modal.classList.remove('hidden');
                    modal.classList.add('flex'); // Use flex for centering
                });

                const closeModal = () => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                };

                closeBtn.addEventListener('click', closeModal);
                modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); }); // Close on backdrop click
            }

            // --- NEW: Sell Now Modal Logic ---
            const sellNowBtn = document.getElementById('sell-now-btn');
            const closeSellNowBtn = document.getElementById('close-sell-now-btn');
            const sellNowModal = document.getElementById('sell-now-modal');

            if (sellNowBtn && closeSellNowBtn && sellNowModal) {
                sellNowBtn.addEventListener('click', () => {
                    sellNowModal.classList.remove('hidden');
                    sellNowModal.classList.add('flex');
                });

                const closeSellModal = () => {
                    sellNowModal.classList.add('hidden');
                    sellNowModal.classList.remove('flex');
                };

                closeSellNowBtn.addEventListener('click', closeSellModal);
                sellNowModal.addEventListener('click', (e) => { if (e.target === sellNowModal) closeSellModal(); });
            }

            // --- NEW: Innovation Lab Modal Logic ---
            const innovationCards = document.querySelectorAll('.innovation-card');
            const labModal = document.getElementById('innovation-lab-modal');
            const closeLabBtn = document.getElementById('close-innovation-lab-btn');
            let labChartInstance;

            const labData = {
                drone: {
                    title: 'Drone Technology',
                    description: 'Agricultural drones equipped with multispectral sensors can monitor crop health, identify stress areas, and apply pesticides or fertilizers with surgical precision. This reduces waste, lowers costs, and increases overall field efficiency.',
                    visual: `<lord-icon src="https://cdn.lordicon.com/jdatDKGW.json" trigger="loop" delay="1500" colors="primary:hsl(var(--primary)),secondary:hsl(var(--accent))" style="width:150px;height:150px"></lord-icon>`,
                    chartData: { costs: [5000, 1500], benefits: [0, 8000] }, // [Initial, Recurring], [Initial, Recurring]
                    insight: 'Drones can increase yield by up to 5% and reduce input costs by 15-20%.'
                },
                hydroponics: {
                    title: 'Hydroponics',
                    description: 'This soilless cultivation technique grows plants in a nutrient-rich water solution. It allows for farming in areas with poor soil, uses up to 90% less water than traditional farming, and enables faster growth cycles in a controlled environment.',
                    visual: `<lord-icon src="https://cdn.lordicon.com/zqqvyuff.json" trigger="loop" delay="1500" colors="primary:hsl(var(--primary)),secondary:hsl(var(--success))" style="width:150px;height:150px"></lord-icon>`,
                    chartData: { costs: [15000, 2000], benefits: [0, 25000] },
                    insight: 'Higher initial setup cost, but can yield 2-5x more produce per square foot annually.'
                },
                'vertical-farming': {
                    title: 'Vertical Farming',
                    description: 'Crops are grown in vertically stacked layers, often integrated with hydroponics and LED lighting. This method drastically reduces land requirements, allowing farms to operate in urban centers, reducing transportation costs and ensuring fresh produce year-round.',
                    visual: `<lord-icon src="https://cdn.lordicon.com/dnoiydox.json" trigger="loop" delay="1500" colors="primary:hsl(var(--primary)),secondary:hsl(var(--secondary))" style="width:150px;height:150px"></lord-icon>`,
                    chartData: { costs: [40000, 8000], benefits: [0, 60000] },
                    insight: 'Extremely high yield per square foot, but significant energy costs for lighting.'
                },
                'iot-sensors': {
                    title: 'IoT Sensors',
                    description: 'A network of smart sensors placed in the field collects real-time data on soil moisture, temperature, pH, and nutrient levels. This data is sent to the cloud, providing farmers with actionable insights to optimize irrigation and fertilization, saving resources.',
                    visual: `<lord-icon src="https://cdn.lordicon.com/uqpazftn.json" trigger="loop" delay="1500" colors="primary:#3b82f6,secondary:hsl(var(--primary))" style="width:150px;height:150px"></lord-icon>`,
                    chartData: { costs: [1000, 100], benefits: [0, 3000] },
                    insight: 'Low initial cost with a quick return by reducing water usage by up to 30%.'
                }
            };

            const openLabModal = (tech) => {
                const data = labData[tech];
                if (!data) return;

                document.getElementById('lab-modal-title').textContent = data.title;
                document.getElementById('lab-modal-description').textContent = data.description;
                document.getElementById('lab-modal-visual').innerHTML = data.visual;
                document.getElementById('lab-modal-insight').querySelector('span').textContent = data.insight;

                const chartCtx = document.getElementById('lab-modal-chart').getContext('2d');
                if (labChartInstance) {
                    labChartInstance.destroy();
                }
                labChartInstance = new Chart(chartCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Initial Investment', 'Annual Recurring'],
                        datasets: [
                            {
                                label: 'Costs ($)',
                                data: data.chartData.costs,
                                backgroundColor: 'hsl(var(--accent) / 0.7)',
                                borderColor: 'hsl(var(--accent))',
                                borderWidth: 2,
                                borderRadius: 4,
                            },
                            {
                                label: 'Benefits ($)',
                                data: data.chartData.benefits,
                                backgroundColor: 'hsl(var(--success) / 0.7)',
                                borderColor: 'hsl(var(--success))',
                                borderWidth: 2,
                                borderRadius: 4,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true, ticks: { callback: value => '$' + value/1000 + 'k' } },
                            x: { grid: { display: false } }
                        },
                        plugins: { legend: { position: 'top' } }
                    }
                });

                labModal.classList.remove('hidden');
                labModal.classList.add('flex');
            };

            const closeLabModal = () => {
                labModal.classList.add('hidden');
                labModal.classList.remove('flex');
            };

            innovationCards.forEach(card => card.addEventListener('click', () => openLabModal(card.dataset.tech)));
            closeLabBtn.addEventListener('click', closeLabModal);
            labModal.addEventListener('click', (e) => { if (e.target === labModal) closeLabModal(); });

            // --- NEW: Sell Now Modal Image Upload Logic ---
            const sellUploadBtn = document.getElementById('sell-upload-btn');
            const sellFileInput = document.getElementById('sell-image-upload');
            const sellPreviewContainer = document.getElementById('sell-image-preview-container');
            const sellImagePreview = document.getElementById('sell-image-preview');
            const sellRemoveBtn = document.getElementById('sell-remove-image-btn');

            if (sellUploadBtn && sellFileInput && sellPreviewContainer) {
                sellUploadBtn.addEventListener('click', () => sellFileInput.click());

                sellFileInput.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            sellImagePreview.src = e.target.result;
                            sellPreviewContainer.classList.remove('hidden');
                            sellPreviewContainer.classList.add('flex');
                            sellUploadBtn.classList.add('hidden');
                        };
                        reader.readAsDataURL(file);
                    }
                });

                sellRemoveBtn.addEventListener('click', () => {
                    sellFileInput.value = '';
                    sellImagePreview.src = '#';
                    sellPreviewContainer.classList.add('hidden');
                    sellPreviewContainer.classList.remove('flex');
                    sellUploadBtn.classList.remove('hidden');
                });
            }
        });

        // --- NEW: Task Management with localStorage ---
        const getTasks = (farmerId) => {
            const allTasks = JSON.parse(localStorage.getItem('agrilogyTasks')) || {};
            return allTasks[farmerId] || [];
        };

        const saveTasks = (farmerId, tasks) => {
            const allTasks = JSON.parse(localStorage.getItem('agrilogyTasks')) || {};
            allTasks[farmerId] = tasks;
            localStorage.setItem('agrilogyTasks', JSON.stringify(allTasks));
        };


        // Store chart instances
        let moistureChart, tempChart, phChart, priceForecastChart;

        let plotDetailChart; // For the mini-chart in the details panel

        // This object will be populated by updateDashboard and used by click handlers.
        // It needs to be in a scope accessible by both.
        const plotData = {
            plotA: {},
            plotB: {},
            plotC: {},
            plotD: {},
            plotE: {}
        };
        // --- NEW: Mandi Data by Region ---
        const mandiData = {
            karnataka: {
                mandis: [
                    { name: "APMC Hubli", prices: { Tomato: 2100, Wheat: 2350, Corn: 1980, Onion: 1800 } },
                    { name: "Central Market, Belgaum", prices: { Tomato: 2150, Wheat: 2320, Corn: 2010, Onion: 1840 } }
                ],
                forecastCrop: "Tomato",
                forecastData: [2150, 2180, 2250, 2350, 2320, 2300, 2280],
                forecastInsight: "Prices are expected to rise mid-week. Consider selling on Thursday for optimal profit."
            },
            uttar_pradesh: {
                mandis: [
                    { name: "Naveen Mandi, Lucknow", prices: { Sugarcane: 350, Cotton: 6500, Wheat: 2200, Potato: 1500 } },
                    { name: "Kanpur Mandi", prices: { Sugarcane: 355, Cotton: 6450, Wheat: 2250, Potato: 1520 } }
                ],
                forecastCrop: "Sugarcane",
                forecastData: [350, 352, 355, 358, 356, 355, 354],
                forecastInsight: "Stable demand for Sugarcane. Prices are expected to remain steady."
            },
            rajasthan: {
                mandis: [
                    { name: "Jaipur Mandi (Fruits & Veg)", prices: { Mustard: 5500, Chickpea: 4800, Millet: 2100, Guar: 6000 } },
                    { name: "Jodhpur Mandi", prices: { Mustard: 5550, Chickpea: 4750, Millet: 2120, Guar: 6100 } }
                ],
                forecastCrop: "Mustard",
                forecastData: [5500, 5520, 5480, 5600, 5590, 5550, 5540],
                forecastInsight: "A slight dip followed by a rise in Mustard prices is expected. Aim to sell late in the week."
            },
            gujarat: {
                mandis: [
                    { name: "Jamalpur Market, Ahmedabad", prices: { Groundnut: 7500, Soybean: 4500, Cumin: 25000, Fennel: 8000 } },
                    { name: "Rajkot Yard", prices: { Groundnut: 7550, Soybean: 4520, Cumin: 25200, Fennel: 8100 } }
                ],
                forecastCrop: "Groundnut",
                forecastData: [7500, 7520, 7550, 7530, 7500, 7480, 7510],
                forecastInsight: "Groundnut prices are stable. Sell anytime this week for a consistent rate."
            },
            punjab: {
                mandis: [
                    { name: "Amritsar Mandi", prices: { Paddy: 3200, Potato: 1200, Maize: 2000, Wheat: 2250 } },
                    { name: "Ludhiana Mandi", prices: { Paddy: 3250, Potato: 1250, Maize: 1980, Wheat: 2260 } }
                ],
                forecastCrop: "Paddy",
                forecastData: [3200, 3210, 3230, 3250, 3240, 3220, 3210],
                forecastInsight: "Paddy prices show a slight upward trend. Holding for a few days might be profitable."
            }
        };
        // --- NEW: Farmer Data and Dashboard Updater ---
        const farmersData = {
            farmer1: {
                name: "Ramesh Kumar",
                location: { lat: 15.35, lon: 75.13 }, // Hubli, Karnataka
                region: "karnataka",
                plots: { // Suggestion: Changed icon from "Tomato" to "carrot" for compatibility with Lucide icons
                    plotA: { name: "Plot A: Tomatoes", icon: "carrot", color: "text-red-500", bgColor: "#fef2f2", details: { stage: "Flowering Stage", metrics: [{ label: "Moisture", value: "42%" }, { label: "Health", value: "85%", valueColor: "text-green-600" }] }, moistureHistory: [55, 53, 50, 48, 46, 44, 42] },
                    plotB: { name: "Plot B: Wheat", icon: "barley", color: "text-yellow-600", bgColor: "#fefce8", details: { stage: "Growth Stage", metrics: [{ label: "Moisture", value: "65%" }, { label: "Health", value: "92%", valueColor: "text-green-600" }] }, moistureHistory: [75, 72, 70, 68, 66, 65, 65] },
                    plotC: { name: "Plot C: Fallow", icon: "Seeds", color: "text-slate-500", bgColor: "#f1f5f9", details: { stage: "Ready for Planting", metrics: [{ label: "Moisture", value: "55%" }, { label: "Nutrients", value: "Good", valueColor: "text-yellow-500" }] }, moistureHistory: [60, 58, 55, 55, 56, 55, 55] },
                    plotD: { name: "Plot D: Corn", icon: "seedling", color: "text-lime-600", bgColor: "#f7fee7", details: { stage: "Tasseling Stage", metrics: [{ label: "Moisture", value: "72%" }, { label: "Health", value: "95%", valueColor: "text-green-600" }] }, moistureHistory: [80, 78, 75, 74, 72, 72, 72] },
                    plotE: { name: "Plot E: Potatoes", icon: "leaf", color: "text-amber-600", bgColor: "#fef3c7", details: { stage: "Tuber Initiation", metrics: [{ label: "Moisture", value: "68%" }, { label: "Health", value: "89%", valueColor: "text-green-600" }] }, moistureHistory: [72, 71, 70, 68, 68, 69, 68] },
                },
                tasks: [
                    { id: Date.now() + 1, text: "Check pest traps in Plot B", completed: false },
                    { id: Date.now() + 2, text: "Prepare Plot C for planting", completed: true }
                ],
                currentCrop: {
                    name: "Tomato (Roma)",
                    plantingDate: "Aug 15, 2025",
                    growthStage: "Flowering",
                    expectedHarvest: "Nov 20-30",
                    health: "85% (Good)"
                },
                cropSuggestions: [
                    { name: "Spinach", profit: "High Profit", reason: "High demand in winter, suitable for current soil NPK levels.", revenue: "~$1,200/acre", growthTime: "40-55 days" },
                    { name: "Lettuce", profit: "Stable Market", reason: "Fast growth cycle, good for crop rotation to improve soil health.", revenue: "~$950/acre", growthTime: "50-70 days" }
                ],
                irrigationSchedule: {
                    insight: "With rain forecasted on Wednesday, you can reduce irrigation frequency.",
                    schedule: [
                        { day: "Today", time: "6:00 AM", amount: "15 min", status: "Completed" },
                        { day: "Tomorrow", time: "6:30 AM", amount: "20 min", status: "Scheduled" },
                        { day: "Wednesday", time: "N/A", amount: "Rain Expected", status: "Skip" }
                    ],
                    pestThreats: { crop: "Tomatoes", threats: ["Blight (Fungal)", "Aphids", "Whitefly", "Hornworms"] }
                }

            },
            farmer2: {
                name: "Sita Devi",
                location: { lat: 26.85, lon: 80.95 }, // Lucknow, UP
                region: "uttar_pradesh",
                plots: {
                    plotA: { name: "Field 1: Sugarcane", icon: "barley", color: "text-green-700", bgColor: "#f0fdf4", details: { stage: "Grand Growth Phase", metrics: [{ label: "Moisture", value: "75%" }, { label: "Health", value: "98%", valueColor: "text-green-600" }] }, moistureHistory: [80, 82, 80, 78, 76, 75, 75] },
                    plotB: { name: "Field 2: Cotton", icon: "flower-2", color: "text-gray-500", bgColor: "#fafafa", details: { stage: "Boll Development", metrics: [{ label: "Moisture", value: "58%" }, { label: "Health", value: "91%", valueColor: "text-green-600" }] }, moistureHistory: [65, 64, 62, 60, 58, 58, 58] },
                    plotC: { name: "Field 3: Fallow", icon: "shovel", color: "text-slate-500", bgColor: "#f1f5f9", details: { stage: "Ready for Planting", metrics: [{ label: "Moisture", value: "62%" }, { label: "Nutrients", value: "Good", valueColor: "text-yellow-500" }] }, moistureHistory: [65, 64, 63, 62, 62, 62, 62] },
                },
                tasks: [
                    { id: Date.now() + 3, text: "Apply urea to Field 2", completed: false },
                    { id: Date.now() + 4, text: "Scout Field 1 for pests", completed: false }
                ],
                currentCrop: {
                    name: "Sugarcane (Co 86032)",
                    plantingDate: "Mar 10, 2025",
                    growthStage: "Grand Growth",
                    expectedHarvest: "Feb 2026",
                    health: "98% (Excellent)"
                },
                cropSuggestions: [
                    { name: "Wheat", profit: "Good Rotation", reason: "Excellent for rotating with sugarcane to break pest cycles and improve soil structure.", revenue: "~$800/acre", growthTime: "120-130 days" },
                    { name: "Mustard", profit: "Cash Crop", reason: "Short duration cash crop that fits well between sugarcane cycles.", revenue: "~$750/acre", growthTime: "100-110 days" }
                ],
                irrigationSchedule: {
                    insight: "Sugarcane requires consistent moisture during its grand growth phase. Maintain regular watering.",
                    schedule: [
                        { day: "Today", time: "7:00 PM", amount: "45 min", status: "Scheduled" },
                        { day: "Tomorrow", time: "7:00 PM", amount: "45 min", status: "Scheduled" },
                        { day: "Wednesday", time: "7:00 PM", amount: "40 min", status: "Scheduled" }
                    ],
                    pestThreats: { crop: "Sugarcane", threats: ["Early Shoot Borer", "Top Borer", "Red Rot", "Smut"] }
                }
            },
            farmer3: {
                name: "Aditi Singh",
                location: { lat: 28.70, lon: 77.10 }, // Delhi
                region: "delhi",
                plots: {
                    plotA: { name: "Rooftop Veggies", icon: "carrot", color: "text-red-500", bgColor: "#fef2f2", details: { stage: "Vegetative Growth", metrics: [{ label: "Moisture", value: "68%" }, { label: "Health", value: "94%", valueColor: "text-green-600" }] }, moistureHistory: [75, 72, 70, 68, 68, 68, 68] },
                    plotB: { name: "Herb Garden", icon: "leaf", color: "text-green-500", bgColor: "#f0fdf4", details: { stage: "Post-Harvest", metrics: [{ label: "Moisture", value: "35%" }, { label: "Soil Prep", value: "Needed", valueColor: "text-amber-600" }] }, moistureHistory: [45, 42, 40, 38, 35, 35, 35] },
                    plotC: { name: "Compost Area", icon: "recycle", color: "text-yellow-700", bgColor: "#fefce8", details: { stage: "Early Growth", metrics: [{ label: "Moisture", value: "78%" }, { label: "Health", value: "96%", valueColor: "text-green-600" }] }, moistureHistory: [80, 78, 78, 78, 79, 78, 78] },
                    plotD: { name: "Flower Patch", icon: "flower", color: "text-pink-500", bgColor: "#fdf2f8", details: { stage: "Ready for Harvest", metrics: [{ label: "Moisture", value: "40%" }, { label: "Maturity", value: "99%", valueColor: "text-blue-600" }] }, moistureHistory: [50, 48, 45, 42, 40, 40, 40] },
                },
                tasks: [
                    { id: Date.now() + 5, text: "Harvest rooftop tomatoes", completed: false },
                    { id: Date.now() + 6, text: "Check for pod borer pests in Chickpea field (Plot B).", completed: false }
                ],
                currentCrop: {
                    name: "Mustard (Pusa Bold)",
                    plantingDate: "Oct 20, 2025",
                    growthStage: "Flowering",
                    expectedHarvest: "Feb 15-25",
                    health: "65% (Stressed)"
                },
                cropSuggestions: [
                    { name: "Millet (Bajra)", profit: "Drought Tolerant", reason: "Highly suitable for Rajasthan's climate and requires less water.", revenue: "~$600/acre", growthTime: "80-90 days" },
                    { name: "Guar (Cluster Bean)", profit: "High Demand", reason: "Industrial demand is high and it's a hardy, low-input crop.", revenue: "~$900/acre", growthTime: "90-100 days" }
                ],
                irrigationSchedule: {
                    insight: "Mustard is water-stressed. Immediate, deep irrigation is critical for recovery.",
                    schedule: [
                        { day: "Today", time: "Immediately", amount: "30 min", status: "Urgent" },
                        { day: "Tomorrow", time: "5:30 AM", amount: "25 min", status: "Scheduled" },
                        { day: "Wednesday", time: "5:30 AM", amount: "25 min", status: "Scheduled" }
                    ],
                    pestThreats: { crop: "Mustard", threats: ["Aphids", "Alternaria Blight", "White Rust", "Sawfly"] }
                }
            },
            farmer4: {
                name: "Anjali Patel",
                location: { lat: 23.02, lon: 72.57 }, // Ahmedabad, Gujarat
                region: "gujarat",
                plots: {
                    plotA: { name: "Plot A: Groundnut", icon: "peanut", color: "text-amber-700", bgColor: "#fffbeb", details: { stage: "Pegging Stage", metrics: [{ label: "Moisture", value: "62%" }, { label: "Health", value: "78%", valueColor: "text-yellow-500" }] }, moistureHistory: [70, 68, 66, 65, 63, 62, 62] },
                    plotB: { name: "Plot B: Soybean", icon: "bean", color: "text-lime-600", bgColor: "#f7fee7", details: { stage: "Flowering Stage", metrics: [{ label: "Moisture", value: "70%" }, { label: "Health", value: "90%", valueColor: "text-green-600" }] }, moistureHistory: [75, 74, 72, 71, 70, 70, 70] },
                },
                recommendation: {
                    title: "Action: Pest Alert in Groundnut Field",
                    body: "Aphids detected in Plot A. Recommend applying neem oil solution."
                },
                tasks: [
                    { id: Date.now() + 7, text: "Apply neem oil to Groundnut field (Plot A).", completed: false }
                ],
                currentCrop: {
                    name: "Groundnut (TG 37A)",
                    plantingDate: "Jun 25, 2025",
                    growthStage: "Pegging",
                    expectedHarvest: "Oct 10-20",
                    health: "78% (Fair)"
                },
                cropSuggestions: [
                    { name: "Cumin", profit: "High Value", reason: "Excellent winter crop for Gujarat with high market value.", revenue: "~$1,500/acre", growthTime: "110-120 days" },
                    { name: "Fennel", profit: "Export Quality", reason: "Good for crop rotation and has strong export potential.", revenue: "~$1,300/acre", growthTime: "150-160 days" }
                ],
                irrigationSchedule: {
                    insight: "Groundnut requires less water during the pegging stage to avoid fungal issues. Monitor soil closely.",
                    schedule: [
                        { day: "Today", time: "N/A", amount: "Monitor Soil", status: "Hold" },
                        { day: "Tomorrow", time: "7:00 AM", amount: "15 min", status: "Tentative" },
                        { day: "Wednesday", time: "N/A", amount: "Rain Expected", status: "Skip" }
                    ],
                    pestThreats: { crop: "Groundnut", threats: ["Tikka Disease", "Rust", "Leaf Miner", "White Grubs"] }
                }
            },
            farmer5: {
                name: "Balwinder Singh",
                location: { lat: 31.63, lon: 74.87 }, // Amritsar, Punjab
                region: "punjab",
                plots: {
                    plotA: { name: "Paddy Field 1", icon: "wheat", color: "text-cyan-600", bgColor: "#ecfeff", details: { stage: "Tillering Stage", metrics: [{ label: "Moisture", value: "85%" }, { label: "Health", value: "94%", valueColor: "text-green-600" }] }, moistureHistory: [90, 88, 86, 85, 85, 85, 85] },
                    plotB: { name: "Paddy Field 2", icon: "wheat", color: "text-cyan-600", bgColor: "#ecfeff", details: { stage: "Tillering Stage", metrics: [{ label: "Moisture", value: "88%" }, { label: "Health", value: "96%", valueColor: "text-green-600" }] }, moistureHistory: [92, 90, 88, 88, 88, 88, 88] },
                    plotC: { name: "Vegetable Patch", icon: "carrot", color: "text-orange-500", bgColor: "#fff7ed", details: { stage: "Harvesting", metrics: [{ label: "Moisture", value: "45%", valueColor: "text-yellow-500" }, { label: "Health", value: "91%", valueColor: "text-green-600" }] }, moistureHistory: [60, 55, 50, 48, 46, 45, 45] },
                },
                tasks: [
                    { id: Date.now() + 8, text: "Top-dress Vegetable Patch with urea.", completed: true },
                    { id: Date.now() + 9, text: "Check water levels in Paddy Fields.", completed: false }
                ],
                currentCrop: {
                    name: "Paddy (Basmati)",
                    plantingDate: "Jul 05, 2025",
                    growthStage: "Tillering",
                    expectedHarvest: "Nov 15-25",
                    health: "94% (Good)"
                },
                cropSuggestions: [
                    { name: "Potato", profit: "High Yield", reason: "Punjab's soil is ideal for potato cultivation after paddy harvest.", revenue: "~$1,800/acre", growthTime: "90-110 days" },
                    { name: "Maize", profit: "Versatile", reason: "Can be used for feed or food, and is a good alternative to break the rice-wheat cycle.", revenue: "~$850/acre", growthTime: "100-120 days" }
                ],
                irrigationSchedule: {
                    insight: "Paddy fields require standing water. Ensure water levels are maintained at 2-3 inches.",
                    schedule: [
                        { day: "Today", time: "Check Level", amount: "Top up as needed", status: "Ongoing" },
                        { day: "Tomorrow", time: "Check Level", amount: "Top up as needed", status: "Ongoing" },
                        { day: "Wednesday", time: "Check Level", amount: "Top up as needed", status: "Ongoing" }
                    ],
                    pestThreats: { crop: "Paddy", threats: ["Stem Borer", "Brown Plant Hopper", "Blast", "Sheath Blight"] }
                }
            }
        };

        // --- NEW: Random AI Recommendations Pool ---
        const aiRecommendations = [
            { title: "Action: Skip Irrigation", body: "High humidity and cloud cover detected. Skipping today's irrigation for Plot A will save water without risk." },
            { title: "Action: Apply Fertilizer", body: "Soil analysis shows low Nitrogen in Plot B. Apply a balanced NPK fertilizer as per recommendation." },
            { title: "Action: Pest Alert", body: "Weather conditions are favorable for aphid growth. Proactively inspect leaf undersides in the vegetable patch." },
            { title: "Action: Market Opportunity", body: "Local demand for leafy greens is high. Consider an early harvest of spinach for a premium price." },
            { title: "Action: Soil Health", body: "The pH in Plot C is slightly acidic. Consider applying lime before the next planting cycle to improve nutrient uptake." },
            { title: "Action: Water Management", body: "Forecast predicts a dry spell. Ensure your drip irrigation system is functioning optimally to conserve water." }
        ];

        // --- NEW: Function to create the mini-chart for plot details ---
        const createDetailChart = (data) => {
            const container = document.getElementById('plot-details-content');
            if (!container) return;

            if (plotDetailChart) {
                plotDetailChart.destroy(); // Destroy previous instance
            }
            container.innerHTML += '<div class="relative h-24 mt-4"><canvas id="plot-detail-chart"></canvas></div>';
            const ctx = document.getElementById('plot-detail-chart');
            if (!ctx) return;

            const accentColor = `hsl(${getComputedStyle(document.documentElement).getPropertyValue('--accent').trim()})`;
            const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 80);
            gradient.addColorStop(0, accentColor.replace(')', ', 0.3)').replace('hsl', 'hsla'));
            gradient.addColorStop(1, accentColor.replace(')', ', 0)').replace('hsl', 'hsla'));

            plotDetailChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['-6d', '-5d', '-4d', '-3d', '-2d', '-1d', 'Now'],
                    datasets: [{
                        label: 'Moisture Trend',
                        data: data,
                        borderColor: accentColor,
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: gradient,
                        pointRadius: 0,
                        pointHoverRadius: 5,
                        pointHoverBackgroundColor: accentColor,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { display: false },
                        x: {
                            ticks: { font: { size: 9 } },
                            grid: { display: false }
                        }
                    },
                    plugins: { 
                        legend: { display: false }, 
                        tooltip: {
                            enabled: true,
                            mode: 'index',
                            intersect: false,
                            displayColors: false,
                            backgroundColor: 'hsl(var(--primary))',
                            titleFont: { weight: 'bold' },
                            bodyFont: { size: 12 },
                            padding: 10,
                        }
                    }
                }
            });
        };

        function updateDashboard(farmerId) {
            const farmer = farmersData[farmerId];
            if (!farmer) return;
    
            // 1. Update Plots
            const plotElements = document.querySelectorAll('.farm-plot[data-plot]');
            plotElements.forEach(plotEl => {
                const plotId = plotEl.dataset.plot;
                const currentPlotData = farmer.plots[plotId];
                const pTag = plotEl.querySelector('p');
                const iTag = plotEl.querySelector('i');
                const metric1El = plotEl.querySelector('.plot-metric-1');
                const metric2El = plotEl.querySelector('.plot-metric-2');
    
                if (currentPlotData) {
                    // Update main plot info
                    pTag.textContent = currentPlotData.name.split(': ')[1]; // Show only crop name
                    pTag.className = `font-bold text-lg mt-2 ${currentPlotData.color.replace('text-', 'text-').replace('-500', '-800')}`;
                    iTag.setAttribute('data-lucide', currentPlotData.icon);
                    iTag.className = `w-12 h-12 ${currentPlotData.color}`;
                    plotEl.style.backgroundColor = currentPlotData.bgColor || '';
                    plotEl.style.display = 'block'; // Make it visible
    
                    // Update metrics
                    const moistureMetric = currentPlotData.details.metrics.find(m => m.label === "Moisture");
                    const healthMetric = currentPlotData.details.metrics.find(m => m.label === "Health");

                    if (metric1El && moistureMetric) {
                        metric1El.innerHTML = `<i data-lucide="droplets" class="w-4 h-4 opacity-70"></i> ${moistureMetric.value}`;
                        metric1El.className = `plot-metric-1 flex items-center gap-1 ${currentPlotData.color.replace('-500', '-700')}`;
                    }
                    if (metric2El && healthMetric) {
                        metric2El.innerHTML = `<i data-lucide="heart-pulse" class="w-4 h-4 opacity-70"></i> ${healthMetric.value}`;
                        metric2El.className = `plot-metric-2 flex items-center gap-1 ${healthMetric.valueColor || currentPlotData.color.replace('-500', '-700')}`;
                    } else if (metric2El) {
                        metric2El.innerHTML = ''; // Clear if no health metric
                    }

                    // Store data directly on the element for the click handler
                    plotEl.dataset.plotData = JSON.stringify({
                        name: currentPlotData.name,
                        details: currentPlotData.details,
                        moistureHistory: currentPlotData.moistureHistory
                    });
                } else {
                    // Hide plot if no data exists for this farmer
                    plotEl.style.display = 'none'; // Keep as none
                }
            });
            lucide.createIcons(); // Re-render icons
    
            // 2. Update AI Recommendation
            const randomRec = aiRecommendations[Math.floor(Math.random() * aiRecommendations.length)];
            document.getElementById('ai-rec-title').textContent = randomRec.title;
            document.getElementById('ai-rec-body').textContent = randomRec.body;

            // 3. Update Tasks
            const tasksList = document.getElementById('tasks-list');
            tasksList.innerHTML = ''; // Clear existing tasks
            let currentTasks = getTasks(farmerId);
            if (currentTasks.length === 0 && farmer.tasks) { // Initialize from template if empty
                currentTasks = farmer.tasks;
                saveTasks(farmerId, currentTasks);
            }

            currentTasks.forEach(task => {
                const taskEl = document.createElement('div');
                taskEl.className = 'flex items-center gap-3 p-2 rounded-lg bg-gray-100 group';
                taskEl.dataset.taskId = task.id;
                taskEl.innerHTML = `
                    <input type="checkbox" class="task-checkbox mt-0" ${task.completed ? 'checked' : ''}>
                    <p class="text-sm font-semibold flex-1 ${task.completed ? 'line-through text-gray-500' : ''}">${task.text}</p>
                    <button class="delete-task-btn text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                `;
                tasksList.appendChild(taskEl);

                // Add listener for in-place editing
                taskEl.querySelector('p').addEventListener('dblclick', (e) => {
                    editTask(e.target.closest('[data-task-id]'), farmerId);
                });
            });
            lucide.createIcons();

            // Add event listeners for new tasks
            tasksList.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const taskId = e.target.closest('[data-task-id]').dataset.taskId;
                    toggleTaskCompletion(farmerId, parseInt(taskId));
                });
            });

            tasksList.querySelectorAll('.delete-task-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const taskId = e.target.closest('[data-task-id]').dataset.taskId;
                    deleteTask(farmerId, parseInt(taskId));
                });
            });

            // 4. Reset to default view and trigger click on first plot
            document.getElementById('plot-details-title').textContent = "Overall Conditions";
            document.getElementById('plot-details-content').innerHTML = `
                <p class="text-sm text-gray-600">Click on a plot for specific details.</p>
                <div class="mt-4 h-24 bg-gray-100 rounded-lg flex items-center justify-center"><p class="text-xs text-gray-400">No plot selected</p></div>
            `;
            document.querySelectorAll('.farm-plot.active').forEach(p => p.classList.remove('active'));
            setTimeout(() => plotElements[0]?.click(), 100); // Click the first available plot
        }
        
        function updateAiAdvisor(farmerId) {
            const farmer = farmersData[farmerId];
            if (!farmer || !farmer.currentCrop) return;

            // Update Current Crop Card
            const currentCropCard = document.querySelector('#ai-advisor .glass-panel');
            if (currentCropCard) {
                currentCropCard.querySelector('.text-lg.font-semibold').textContent = farmer.currentCrop.name;
                const details = currentCropCard.querySelectorAll('ul li span.font-semibold');
                if (details.length === 4) {
                    details[0].textContent = farmer.currentCrop.plantingDate;
                    details[1].textContent = farmer.currentCrop.growthStage;
                    details[2].textContent = farmer.currentCrop.expectedHarvest;
                    details[3].textContent = farmer.currentCrop.health;
                }
            }

            // Update Crop Suggestions
            const suggestionsContainer = document.querySelector('#ai-advisor .space-y-3');
            if (suggestionsContainer && farmer.cropSuggestions) {
                suggestionsContainer.innerHTML = ''; // Clear existing suggestions
                farmer.cropSuggestions.forEach(suggestion => {
                    const suggestionHTML = `
                        <div class="p-4 rounded-lg bg-gray-100 border">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-lg">${suggestion.name}</h4>
                                <span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-200 rounded-full">${suggestion.profit}</span>
                            </div>
                            <p class="text-xs opacity-80 mb-3">${suggestion.reason}</p>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm border-t pt-3 mt-3">
                                <div class="flex items-center gap-2"><i data-lucide="dollar-sign" class="w-4 h-4 text-green-600"></i><div><p class="text-xs opacity-70">Est. Revenue</p><p class="font-semibold">${suggestion.revenue}</p></div></div>
                                <div class="flex items-center gap-2"><i data-lucide="calendar-days" class="w-4 h-4 text-blue-600"></i><div><p class="text-xs opacity-70">Growth Time</p><p class="font-semibold">${suggestion.growthTime}</p></div></div>
                            </div>
                        </div>
                    `;
                    suggestionsContainer.innerHTML += suggestionHTML;
                });
                lucide.createIcons(); // Re-render any new icons
            }

            // Update Irrigation Schedule
            const irrigationContainer = document.getElementById('irrigation-schedule-list');
            const irrigationInsightEl = document.getElementById('irrigation-insight')?.querySelector('span');
            if (irrigationContainer && irrigationInsightEl && farmer.irrigationSchedule) {
                irrigationContainer.innerHTML = ''; // Clear existing
                irrigationInsightEl.textContent = farmer.irrigationSchedule.insight;

                farmer.irrigationSchedule.schedule.forEach(item => {
                    let statusColor = 'text-gray-500';
                    if (item.status === 'Completed') statusColor = 'text-green-600';
                    if (item.status === 'Scheduled') statusColor = 'text-blue-600';
                    if (item.status === 'Urgent') statusColor = 'text-red-600 font-bold';
                    if (item.status === 'Skip') statusColor = 'text-yellow-600';

                    const itemHTML = `
                        <div class="grid grid-cols-3 items-center text-sm p-2 rounded-lg even:bg-gray-50">
                            <span class="font-semibold">${item.day}</span>
                            <span class="text-center opacity-80">${item.time}</span>
                            <div class="text-right">
                                <span class="font-semibold">${item.amount}</span>
                                <p class="text-xs ${statusColor}">${item.status}</p>
                            </div>
                        </div>
                    `;
                    irrigationContainer.innerHTML += itemHTML;
                });
            } else if (irrigationContainer) {
                irrigationContainer.innerHTML = `
                    <div class="p-3 rounded-lg bg-gray-100 border text-center">
                        <p class="text-sm text-gray-500">No irrigation data available.</p>
                    </div>`;
            }

            // Update Pest & Disease Card
            const pestCard = document.querySelector('#ai-advisor .glass-panel:nth-child(3)'); // Assumes it's the 3rd card
            if (pestCard && farmer.pestThreats) {
                const titleEl = pestCard.querySelector('.space-y-2 p');
                const listEl = pestCard.querySelector('.space-y-2 ul');

                if (titleEl && listEl) {
                    titleEl.textContent = `Common threats for ${farmer.pestThreats.crop}:`;
                    listEl.innerHTML = ''; // Clear existing threats
                    farmer.pestThreats.threats.forEach(threat => {
                        const li = document.createElement('li');
                        li.textContent = threat;
                        listEl.appendChild(li);
                    });
                }
                // Also reset the image upload state when changing farmers
                resetCard();
            }
        }

        // --- NEW: In-place task editing function ---
        const editTask = (taskEl, farmerId) => {
            const pTag = taskEl.querySelector('p');
            const taskId = parseInt(taskEl.dataset.taskId);
            const currentText = pTag.textContent;

            // Prevent editing if already editing
            if (taskEl.querySelector('input[type="text"]')) return;

            const inputEl = document.createElement('input');
            inputEl.type = 'text';
            inputEl.value = currentText;
            inputEl.className = 'text-sm font-semibold flex-1 bg-gray-100 border rounded px-1 py-0 w-full';

            pTag.replaceWith(inputEl);
            inputEl.focus();
            inputEl.select();

            const saveEdit = () => {
                const newText = inputEl.value.trim();
                if (newText && newText !== currentText) {
                    const tasks = getTasks(farmerId);
                    const task = tasks.find(t => t.id === taskId);
                    if (task) {
                        task.text = newText;
                        saveTasks(farmerId, tasks);
                    }
                }
                // Revert to the <p> tag, even if no changes were made
                pTag.textContent = newText || currentText; // Revert if empty
                inputEl.replaceWith(pTag);
            };

            inputEl.addEventListener('blur', saveEdit);
            inputEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') inputEl.blur(); });
        };

        // --- NEW: Function to update MarketLink section ---
        function updateMarketLink(farmerId) {
            const farmer = farmersData[farmerId];
            const regionData = mandiData[farmer.region];
            if (!regionData) return;

            // 1. Update Mandi Prices
            const container = document.getElementById('mandi-prices-container');
            container.innerHTML = ''; // Clear old prices
            regionData.mandis.forEach(mandi => {
                let pricesHTML = '';
                Object.entries(mandi.prices).forEach(([crop, price]) => {
                    pricesHTML += `<div class="flex justify-between border-b pb-2"><span>${crop}:</span> <span class="font-bold">‚Çπ${price.toLocaleString('en-IN')} /qtl</span></div>`;
                });

                const mandiCardHTML = `
                    <div class="glass-panel p-6 rounded-2xl">
                        <h4 class="font-bold text-lg mb-3">${mandi.name}</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            ${pricesHTML}
                        </div>
                    </div>
                `;
                container.innerHTML += mandiCardHTML;
            });

            // 2. Update AI Price Forecast
            document.getElementById('forecast-crop-name').textContent = regionData.forecastCrop;
            document.getElementById('forecast-insight').querySelector('span').textContent = regionData.forecastInsight;

            const priceCtx = document.getElementById('priceForecastChart');
            if (priceForecastChart) {
                priceForecastChart.destroy(); // Destroy old chart instance
            }
            
            const chartColor = getComputedStyle(priceCtx.parentElement).getPropertyValue('--chart-color').trim() || 'hsl(var(--secondary))';
            const priceGradient = priceCtx.getContext('2d').createLinearGradient(0, 0, 0, 250);            priceGradient.addColorStop(0, chartColor.replace(')', ', 0.4)').replace('hsl', 'hsla'));
            priceGradient.addColorStop(1, chartColor.replace(')', ', 0)').replace('hsl', 'hsla'));

            priceForecastChart = new Chart(priceCtx, {
                type: 'line',
                data: {
                    labels: ['Today', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: `Projected Price (‚Çπ/qtl) for ${regionData.forecastCrop}`,
                        data: regionData.forecastData,
                        borderColor: chartColor,
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: priceGradient,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: chartColor,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { display: false }, 
                        tooltip: { 
                            mode: 'index', 
                            intersect: false,
                            backgroundColor: 'hsl(var(--primary))',
                            titleFont: { weight: 'bold' },
                            bodyFont: { size: 14 },
                            padding: 12,
                        } 
                    }, 
                    scales: { y: { beginAtZero: false } } }
            });
        }

        // --- NEW: Virtual Farm Simulator Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const irrigationSlider = document.getElementById('sim-irrigation');
            const irrigationValue = document.getElementById('sim-irrigation-value');
            const fertilizerSelect = document.getElementById('sim-fertilizer');
            const runBtn = document.getElementById('run-simulation-btn');
            const resultsContainer = document.getElementById('simulation-results');
            const plotContainer = document.getElementById('simulator-plot');
            const simOverlay = document.getElementById('simulation-overlay');
            const simDay = document.getElementById('simulation-day');
            const eventLog = document.getElementById('event-log');
            let simulationInterval;

            // --- NEW: Data for Soil and Pest Control ---
            const soilData = {
                loamy: { name: "Loamy", waterRetention: 1.0 },
                clay: { name: "Clay", waterRetention: 0.7 }, // Retains more, so less evaporation effect
                sandy: { name: "Sandy", waterRetention: 1.5 }, // Drains fast, so more evaporation effect
            };
            const pestControlData = {
                none: { name: "None", vulnerability: 1.0, cost: 0 },
                organic: { name: "Organic", vulnerability: 0.5, cost: 50 },
                chemical: { name: "Chemical", vulnerability: 0.1, cost: 150 },
            };
            const fertilizerCostData = {
                none: 0,
                npk: 2000,
                nitrogen: 1500,
                organic: 2500
            };
            // --- NEW: Data for Crops and Scenarios ---
            const cropData = {
                tomato: { name: "Tomato", optimalIrrigation: [40, 70], baseYield: 8.5, basePrice: 12000, growthTime: 90, fertilizerSensitivity: { npk: 1.1, nitrogen: 0.9, organic: 1.0, none: 0.7 } },
                corn: { name: "Corn", optimalIrrigation: [50, 80], baseYield: 4.0, basePrice: 18000, growthTime: 100, fertilizerSensitivity: { npk: 1.2, nitrogen: 1.1, organic: 1.0, none: 0.6 } },
                lettuce: { name: "Lettuce", optimalIrrigation: [35, 60], baseYield: 6.0, basePrice: 15000, growthTime: 60, fertilizerSensitivity: { npk: 1.0, nitrogen: 1.1, organic: 1.05, none: 0.8 } },
            };

            const scenarioData = {
                normal: { name: "Normal Season", description: "A balanced season.", modifiers: { evaporationRate: 1.0, rainChance: 0.05, pestChance: 0.05 } },
                drought: { name: "Drought", description: "Water is scarce.", modifiers: { evaporationRate: 1.8, rainChance: 0.01, pestChance: 0.05 } },
                wet: { name: "Wet Season", description: "Frequent rainfall.", modifiers: { evaporationRate: 0.7, rainChance: 0.20, pestChance: 0.10 } },
                pests: { name: "Pest Outbreak", description: "Pests are rampant.", modifiers: { evaporationRate: 1.0, rainChance: 0.05, pestChance: 0.30 } },
            };

            // --- NEW: Populate Scenario Descriptions ---
            const scenarioSelect = document.getElementById('sim-scenario');
            if (scenarioSelect) {
                scenarioSelect.addEventListener('change', (e) => {
                    const scenario = scenarioData[e.target.value];
                    // Could add a tooltip or description element here if desired
                    // For now, it just changes the logic
                });
            }
            const cropSelect = document.getElementById('sim-crop');
            if (cropSelect) {
                cropSelect.addEventListener('change', (e) => {
                    const crop = cropData[e.target.value];
                    // Update irrigation slider to crop's optimal midpoint
                    const optimalMidpoint = (crop.optimalIrrigation[0] + crop.optimalIrrigation[1]) / 2;
                    irrigationSlider.value = optimalMidpoint;
                    irrigationValue.textContent = `${optimalMidpoint}%`;
                });
            }

            // --- NEW: Simulator Help Modal Logic ---
            const helpBtn = document.getElementById('simulator-help-btn');
            const helpModal = document.getElementById('simulator-help-modal');
            const closeHelpBtn = document.getElementById('close-simulator-help-btn');
            const helpContentWrapper = document.getElementById('simulator-help-content-wrapper');

            const populateSimulatorHelp = () => {
                const contentEl = document.getElementById('simulator-help-content');
                
                const createTable = (title, data, headers, rowFn) => {
                    let tableHTML = `<div class="p-4 border rounded-lg bg-gray-50">
                        <h4 class="font-bold text-lg mb-2">${title}</h4>
                        <table class="w-full text-sm text-left">
                            <thead class="border-b"><tr>${headers.map(h => `<th class="pb-1">${h}</th>`).join('')}</tr></thead>
                            <tbody>`;
                    for (const key in data) {
                        tableHTML += rowFn(data[key]);
                    }
                    tableHTML += `</tbody></table></div>`;
                    return tableHTML;
                };

                contentEl.innerHTML = ''; // Clear previous content

                // Crop Data
                contentEl.innerHTML += createTable('Crop Data', cropData, ['Crop', 'Optimal Irrigation', 'Base Yield', 'Base Price'],
                    (item) => `<tr><td class="py-1 font-semibold">${item.name}</td><td>${item.optimalIrrigation.join('-')}%</td><td>${item.baseYield} t/acre</td><td>‚Çπ${item.basePrice.toLocaleString('en-IN')}</td></tr>`
                );

                // Scenario Data
                contentEl.innerHTML += createTable('Scenario Modifiers', scenarioData, ['Scenario', 'Description'],
                    (item) => `<tr><td class="py-1 font-semibold">${item.name}</td><td>${item.description}</td></tr>`
                );

                // Soil Data
                contentEl.innerHTML += createTable('Soil Types', soilData, ['Soil', 'Water Retention'],
                    (item) => `<tr><td class="py-1 font-semibold">${item.name}</td><td>${item.waterRetention === 1.0 ? 'Normal' : (item.waterRetention < 1.0 ? 'High' : 'Low')}</td></tr>`
                );

                // Pest Control Data
                contentEl.innerHTML += createTable('Pest Control', pestControlData, ['Method', 'Vulnerability', 'Cost'],
                    (item) => `<tr><td class="py-1 font-semibold">${item.name}</td><td>${item.vulnerability * 100}%</td><td>${item.cost} /day</td></tr>`
                );
            };

            if (helpBtn && helpModal && closeHelpBtn) {
                helpBtn.addEventListener('click', () => {
                    populateSimulatorHelp();
                    helpModal.classList.remove('hidden');
                    helpModal.classList.add('flex');
                    setTimeout(() => {
                        helpContentWrapper.classList.remove('scale-95', 'opacity-0');
                    }, 10);
                });

                const closeHelpModal = () => {
                    helpContentWrapper.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => helpModal.classList.add('hidden'), 300);
                };
                closeHelpBtn.addEventListener('click', closeHelpModal);
                helpModal.addEventListener('click', (e) => { if (e.target === helpModal) closeHelpModal(); });
            }

            // Update slider value display
            if (irrigationSlider && irrigationValue) {
                irrigationSlider.addEventListener('input', () => {
                    irrigationValue.textContent = `${irrigationSlider.value}%`;
                });
            }

            const generatePlants = (yieldValue) => {
                plotContainer.innerHTML = '';
                for (let i = 0; i < 40; i++) { // Generate a full plot of potential plants
                    const plantWrapper = document.createElement('div');
                    plantWrapper.innerHTML = `<svg class="sim-plant w-full h-full" viewBox="0 0 20 30"><path d="M10 30 C 5 20, 15 20, 10 10" stroke-width="2" fill="none" class="plant-stem" /><path d="M10 18 C 0 15, 5 10, 10 10" fill="currentColor" class="plant-leaf-left" /><path d="M10 18 C 20 15, 15 10, 10 10" fill="currentColor" class="plant-leaf-right" /></svg>`;
                    plotContainer.appendChild(plantWrapper);
                }
            };

            const logEvent = (message, type = 'info') => {
                const p = document.createElement('p');
                p.textContent = message;
                if (type === 'bad') p.className = 'text-red-300';
                if (type === 'good') p.className = 'text-green-300';
                eventLog.prepend(p);
            };

            const getGrade = (profit) => {
                if (profit > 45000) return { grade: 'A+', title: 'Master Farmer' };
                if (profit > 40000) return { grade: 'A', title: 'Expert Grower' };
                if (profit > 35000) return { grade: 'B', title: 'Green Thumb' };
                if (profit > 25000) return { grade: 'C', title: 'Promising Farmer' };
                if (profit > 15000) return { grade: 'D', title: 'Needs Improvement' };
                return { grade: 'F', title: 'Try Again' };
            };

            if (runBtn) {
                runBtn.addEventListener('click', () => {
                    // Reset and start simulation
                    clearInterval(simulationInterval);
                    resultsContainer.classList.add('hidden');
                    simOverlay.classList.remove('hidden');
                    simOverlay.classList.add('flex');
                    eventLog.innerHTML = '';
                    runBtn.textContent = 'Season in Progress...';
                    runBtn.disabled = true;
                    generatePlants();

                    const plants = document.querySelectorAll('.sim-plant');
                    let day = 0;
                    let health = 100;
                    let waterLevel = 50;
                    let growth = 0;
                    let marketBonus = 1.0;

                    const irrigationInput = parseInt(irrigationSlider.value);
                    const fertilizerInput = fertilizerSelect.value;
                    const selectedCrop = cropData[document.getElementById('sim-crop').value];
                    const selectedScenario = scenarioData[document.getElementById('sim-scenario').value];
                    const selectedSoil = soilData[document.getElementById('sim-soil').value];
                    const selectedPestControl = pestControlData[document.getElementById('sim-pest-control').value];
                    const simDuration = selectedCrop.growthTime;

                    simulationInterval = setInterval(() => {
                        day++;
                        
                        // --- Core Simulation Logic ---
                        // Water level changes
                        waterLevel -= (5 * selectedScenario.modifiers.evaporationRate * selectedSoil.waterRetention); // Evaporation modified by soil
                        waterLevel += (irrigationInput / 10); // Daily irrigation
                        waterLevel = Math.max(0, Math.min(100, waterLevel));

                        // Health changes based on water
                        if (waterLevel < selectedCrop.optimalIrrigation[0] || waterLevel > selectedCrop.optimalIrrigation[1]) {
                            health -= 2; // Stress
                        } else {
                            health += 1; // Optimal
                        }
                        health = Math.max(0, Math.min(100, health));

                        // Growth
                        growth += health / 100 * 0.01;

                        // Random Events
                        if (Math.random() < (selectedScenario.modifiers.pestChance * selectedPestControl.vulnerability)) { // Pest chance modified by control method
                            logEvent(`Day ${day}: Pest Attack! Health decreased.`, 'bad');
                            health -= 15;
                        }
                        if (Math.random() < selectedScenario.modifiers.rainChance) { // Rain chance
                            const eventType = Math.random();
                            if (eventType < 0.6) { // 60% chance of rain event being beneficial
                                logEvent(`Day ${day}: Unexpected Rainfall! Water level up.`, 'good');
                                waterLevel = Math.min(100, waterLevel + 40);
                            } else {
                                logEvent(`Day ${day}: Sunny Spell! Growth boosted.`, 'good');
                                growth += 0.1;
                            }
                        }

                        // --- Update Visuals ---
                        simDay.textContent = `Day ${day} / ${simDuration}`;
                        plants.forEach(plant => {
                            plant.style.opacity = '1';
                            plant.style.transform = `scale(${growth})`;
                            let color = '#65a30d'; // lime-600
                            if (health < 70) color = '#facc15'; // yellow-400
                            if (health < 40) color = '#b45309'; // amber-800
                            plant.style.color = color;
                        });

                        if (day >= simDuration) {
                            clearInterval(simulationInterval);
                            
                            // --- Final Calculations ---
                            let yieldFactor = (health / 100) * (growth / (simDuration * 0.01));
                            yieldFactor *= selectedCrop.fertilizerSensitivity[fertilizerInput];

                            const totalCost = (selectedPestControl.cost * simDuration) + (fertilizerCostData[fertilizerInput] || 0);
                            const finalYield = (selectedCrop.baseYield * yieldFactor).toFixed(1);
                            const grossRevenue = selectedCrop.basePrice * finalYield * marketBonus;
                            const finalProfit = (grossRevenue - totalCost).toFixed(0);
                            const { grade, title } = getGrade(finalProfit);

                            // --- Display Results ---
                            document.getElementById('sim-yield-output').textContent = `${finalYield} tons/acre`;
                            document.getElementById('sim-profit-output').textContent = `‚Çπ${parseInt(finalProfit).toLocaleString('en-IN')}`;
                            document.getElementById('sim-grade').textContent = grade;
                            document.getElementById('sim-title').textContent = title;
                            
                            let feedback = '';
                            if (irrigationInput < selectedCrop.optimalIrrigation[0] || irrigationInput > selectedCrop.optimalIrrigation[1]) feedback += `Your irrigation on ${selectedSoil.name.toLowerCase()} soil was outside the optimal range for ${selectedCrop.name}. `;
                            else feedback += 'Excellent irrigation management! ';
                            if (health < 50) feedback += `The plants suffered from poor health. Your choice of '${selectedPestControl.name}' pest control may not have been sufficient for this season. `;
                            else feedback += 'The plants remained healthy throughout the season. ';
                            document.getElementById('sim-feedback-text').textContent = feedback;

                            resultsContainer.classList.remove('hidden');
                            simOverlay.classList.add('hidden');
                            simOverlay.classList.remove('flex');
                            runBtn.textContent = 'Start New Season';
                            runBtn.disabled = false;
                            lucide.createIcons();
                        }
                    }, 100); // Each interval is a "day"
                });
            }
        });

        // --- NEW: Task CRUD functions ---
        const addTask = (farmerId) => {
            const text = prompt("Enter new task:");
            if (text && text.trim() !== "") {
                const tasks = getTasks(farmerId);
                tasks.push({ id: Date.now(), text: text.trim(), completed: false });
                saveTasks(farmerId, tasks);
                updateDashboard(farmerId); // Re-render to show the new task
            }
        };

        const toggleTaskCompletion = (farmerId, taskId) => {
            const tasks = getTasks(farmerId);
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveTasks(farmerId, tasks);
                // Just update the UI for this one task instead of full re-render
                const taskEl = document.querySelector(`[data-task-id='${taskId}'] p`);
                taskEl.classList.toggle('line-through');
                taskEl.classList.toggle('text-gray-500');
            }
        };

        const deleteTask = (farmerId, taskId) => {
            if (confirm("Are you sure you want to delete this task?")) {
                let tasks = getTasks(farmerId);
                tasks = tasks.filter(t => t.id !== taskId);
                saveTasks(farmerId, tasks);
                // Re-render to remove the task from UI
                const taskEl = document.querySelector(`[data-task-id='${taskId}']`);
                if (taskEl) taskEl.remove();
            }
        };

        // Event Listener for the dropdown
        const farmerSelector = document.getElementById('farmer-selector');
        farmerSelector.addEventListener('change', (e) => {
            updateDashboard(e.target.value);
            updateAiAdvisor(e.target.value);
            updateMarketLink(e.target.value);
        });

        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            const addTaskBtn = document.getElementById('add-task-btn');
            addTaskBtn.addEventListener('click', () => {
                const currentFarmerId = farmerSelector.value;
                addTask(currentFarmerId);
            });
        });

        // --- REVISED: Farm Plot Interaction Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const farmLayout = document.querySelector('.farm-layout');
            const detailsTitle = document.getElementById('plot-details-title');
            const detailsContent = document.getElementById('plot-details-content');
    
            // Use event delegation for efficiency
            farmLayout.addEventListener('click', (e) => {
                const plotEl = e.target.closest('.farm-plot');
                if (!plotEl) return;
    
                // Deactivate all other plots
                farmLayout.querySelectorAll('.farm-plot').forEach(p => p.classList.remove('active'));
    
                // Activate the clicked plot
                plotEl.classList.add('active');
    
                // Parse the data stored on the element
                const data = JSON.parse(plotEl.dataset.plotData || '{}');
    
                // Update the side panel with details for the clicked plot
                if (data.name && detailsTitle && detailsContent) {
                    detailsTitle.textContent = data.name;
    
                    const metricsHtml = data.details.metrics.map(metric => `
                        <div class="p-2 bg-gray-100 rounded-lg">
                            <p class="text-xs opacity-70">${metric.label}</p>
                            <p class="font-bold text-lg ${metric.valueColor || ''}">${metric.value}</p>
                        </div>
                    `).join('');
    
                    detailsContent.innerHTML = `<p class="text-sm text-gray-600 mb-2">${data.details.stage}</p><div class="grid grid-cols-2 gap-2 text-center">${metricsHtml}</div>`;
    
                    createDetailChart(data.moistureHistory);
                }
            });
            // Trigger a click on the first plot on load for a default view
            // This ensures the side panel is populated and the first card is flipped
            setTimeout(() => {
                if (farmPlots.length > 0) {
                    farmPlots[0].click();
                }
            }, 100); // Small delay to ensure data is populated
        });
        updateDashboard('farmer1');
        updateAiAdvisor('farmer1');
        updateMarketLink('farmer1');


        // --- NEW: Hero Section Typewriter and Demo ---
        const typeWriter = (element, text, speed) => {
            let i = 0;
            element.innerHTML = ''; // Clear existing text
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    // Add blinking cursor at the end
                    element.innerHTML += '<span class="animate-ping">_</span>';
                }
            }
            type();
        };

        const taglineEl = document.getElementById('tagline');
        if (taglineEl) {
            const taglineText = "AI ‚Ä¢ IoT ‚Ä¢ Offline Connectivity ‚Ä¢ Farmer Inclusion üåæ";
            typeWriter(taglineEl, taglineText, 75);
        }

        // --- NEW: Pest & Disease Image Upload ---
        const uploadBtn = document.getElementById('upload-image-btn');
        const fileInput = document.getElementById('image-upload-input');
        const threatStatusBox = document.getElementById('threat-status-box');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.getElementById('image-preview');
        const removeImageBtn = document.getElementById('remove-image-btn');
        const analysisResultContainer = document.getElementById('analysis-result-container');
        const uploadBtnIcon = document.getElementById('upload-btn-icon');

        let currentCardState = 'initial'; // 'initial', 'preview', 'analyzing', 'result'

        const resetCard = () => {
            fileInput.value = ''; // Clear the file input
            threatStatusBox.classList.remove('hidden');
            imagePreviewContainer.classList.add('hidden');
            analysisResultContainer.classList.add('hidden');
            
            uploadBtn.disabled = false;
            uploadBtnIcon.setAttribute('data-lucide', 'camera');
            uploadBtnIcon.classList.remove('animate-spin');
            uploadBtn.lastChild.textContent = ' Upload Image for Analysis';
            lucide.createIcons();
            
            currentCardState = 'initial';
        };

        if (uploadBtn && fileInput) {
            uploadBtn.addEventListener('click', () => {
                if (currentCardState === 'initial') {
                    fileInput.click();
                } else if (currentCardState === 'preview') {
                    // --- Run Analysis ---
                    currentCardState = 'analyzing';
                    uploadBtn.disabled = true;
                    uploadBtnIcon.setAttribute('data-lucide', 'loader-2');
                    uploadBtnIcon.classList.add('animate-spin');
                    uploadBtn.lastChild.textContent = ' Analyzing...';
                    lucide.createIcons();
                    
                    setTimeout(() => {
                        // --- Show Results ---
                        imagePreviewContainer.classList.add('hidden');
                        analysisResultContainer.classList.remove('hidden');
                        
                        uploadBtn.disabled = false;
                        uploadBtnIcon.setAttribute('data-lucide', 'refresh-cw');
                        uploadBtnIcon.classList.remove('animate-spin');
                        uploadBtn.lastChild.textContent = ' Start New Analysis';
                        lucide.createIcons();
                        
                        currentCardState = 'result';
                    }, 2500); // Simulate 2.5 second analysis

                } else if (currentCardState === 'result') {
                    resetCard();
                }
            });

            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imagePreview.src = e.target.result;
                        threatStatusBox.classList.add('hidden');
                        imagePreviewContainer.classList.remove('hidden');
                        
                        // Update button to "Analyze"
                        uploadBtnIcon.setAttribute('data-lucide', 'scan-search');
                        uploadBtn.lastChild.textContent = ' Analyze This Image';
                        lucide.createIcons();
                        
                        currentCardState = 'preview';
                    };
                    reader.readAsDataURL(file);
                }
            });

            removeImageBtn.addEventListener('click', () => {
                resetCard();
            });
        }

        // --- NEW: AgriMitra Card Click-to-Flip for Mobile ---
        document.addEventListener('DOMContentLoaded', () => {
            const flipCards = document.querySelectorAll('#about .flip-card');
            
            flipCards.forEach(card => {
                card.addEventListener('click', function() {
                    // This allows tapping on mobile to flip the card
                    this.classList.toggle('is-flipped');
                });
            });
        });

        // --- NEW: Scripts for Integrated Offline AI Module ---
        // Initialize Lucide Icons
        lucide.createIcons();

        // --- NEW: AI Analysis Button Interaction ---
        const runAiBtn = document.getElementById('run-ai-btn');
        const aiPredictionCard = document.getElementById('ai-prediction-card');

        runAiBtn.addEventListener('click', () => {
            // --- 1. Enter Loading State ---
            const btnIcon = document.getElementById('run-ai-btn-icon');
            const btnText = document.getElementById('run-ai-btn-text');
            
            runAiBtn.disabled = true;
            runAiBtn.classList.add('cursor-not-allowed');
            btnIcon.setAttribute('data-lucide', 'loader-2');
            btnIcon.classList.add('animate-spin');
            btnText.textContent = 'Analyzing...';
            lucide.createIcons(); // Re-render the new icon

            // Fade out the old prediction content
            aiPredictionCard.style.opacity = '0.5';

            // --- 2. Simulate AI Analysis (2-second delay) ---
            setTimeout(() => {
                // --- 3. Update Prediction Card with new data ---
                document.getElementById('ai-soil-condition').textContent = 'Optimal moisture levels detected.';
                document.getElementById('ai-time-to-dryness').textContent = 'Approx. 8 hrs 15 min';
                
                const newConfidence = 95;
                document.getElementById('ai-confidence-bar').style.width = `${newConfidence}%`;
                document.getElementById('ai-confidence-text').textContent = `${newConfidence}%`;

                document.getElementById('ai-rec-irrigation').innerHTML = 'No immediate irrigation needed. Monitor in 6-8 hours.';
                document.getElementById('ai-rec-amendment').innerHTML = 'pH is stable. No action required.';

                // --- 4. Exit Loading State ---
                runAiBtn.disabled = false;
                runAiBtn.classList.remove('cursor-not-allowed');
                btnIcon.setAttribute('data-lucide', 'brain');
                btnIcon.classList.remove('animate-spin');
                btnText.textContent = 'Run AI Analysis';
                lucide.createIcons(); // Re-render the original icon

                // Fade in the new content
                aiPredictionCard.style.opacity = '1';

                // Bonus: Add a subtle pulse effect to show it has updated
                aiPredictionCard.classList.add('glow-pulse');
                setTimeout(() => {
                    aiPredictionCard.classList.remove('glow-pulse');
                }, 2100); // Remove after one pulse cycle

            }, 2000);
        });

        // Add a simple alert for the refresh button for demonstration
        const refreshBtn = document.getElementById('refresh-btn');
        refreshBtn.addEventListener('click', () => {
            alert('Fetching latest sensor readings...');
        });

        // --- NEW: Profit Calculator Logic ---
        const calcCropSelect = document.getElementById('calc-crop');
        const calcAreaInput = document.getElementById('calc-area');

        const calculatorData = {
            tomato: { roi: 150, breakeven: 4, trend: 'upward' },
            wheat: { roi: 80, breakeven: 6, trend: 'stable' },
            sugarcane: { roi: 120, breakeven: 10, trend: 'stable' },
            cotton: { roi: 95, breakeven: 7, trend: 'downward' }
        };

        const updateCalculator = () => {
            const crop = calcCropSelect.value;
            const area = parseFloat(calcAreaInput.value) || 1;
            const data = calculatorData[crop];

            if (!data) return;

            // Adjust ROI based on area (economy of scale)
            const adjustedRoi = data.roi + (Math.log(area) * 10);
            document.getElementById('calc-roi').textContent = `${Math.round(adjustedRoi)}%`;

            // Adjust breakeven
            document.getElementById('calc-breakeven').textContent = `${data.breakeven} months`;

            // Update trend
            const trendEl = document.getElementById('calc-trend');
            if (data.trend === 'upward') {
                trendEl.innerHTML = `<i data-lucide="trending-up" class="w-8 h-8 text-blue-600"></i><span class="text-2xl font-bold text-blue-600">Upward</span>`;
            } else if (data.trend === 'downward') {
                trendEl.innerHTML = `<i data-lucide="trending-down" class="w-8 h-8 text-red-600"></i><span class="text-2xl font-bold text-red-600">Downward</span>`;
            } else {
                trendEl.innerHTML = `<i data-lucide="trending-up" class="w-8 h-8 text-gray-500"></i><span class="text-2xl font-bold text-gray-500">Stable</span>`;
            }
            lucide.createIcons();
        };

        if (calcCropSelect && calcAreaInput) {
            calcCropSelect.addEventListener('change', updateCalculator);
            calcAreaInput.addEventListener('input', updateCalculator);
            updateCalculator(); // Initial calculation
        }
    })(); // <-- End of IIFE
    </script>
</body>
</html>
    <script>
    (function() { // <-- Start of IIFE
        // --- NEW: Scroll to top on page load ---

        window.addEventListener('load', () => {
            // Use setTimeout to ensure it runs after any other potential scripts
            // that might affect scroll position.
            setTimeout(() => window.scrollTo(0, 0), 0);
        });

        // --- NEW: AgriBot Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const botContainer = document.getElementById('agribot-container');
            if (!botContainer) return;

            const avatarBtn = document.getElementById('agribot-avatar');
            const chatWindow = document.getElementById('agribot-chat-window');
            const closeBtn = document.getElementById('close-agribot-btn');
            const messagesContainer = document.getElementById('agribot-messages');
            const chatForm = document.getElementById('agribot-form');
            const inputField = document.getElementById('agribot-input');
            const eyeLeft = document.getElementById('agribot-eye-left');
            const eyeRight = document.getElementById('agribot-eye-right');

            // Eye Tracking
            document.addEventListener('mousemove', (e) => {
                if (chatWindow.classList.contains('hidden')) {
                    const { clientX, clientY } = e;
                    const { left, top, width, height } = avatarBtn.getBoundingClientRect();
                    const avatarCenterX = left + width / 2;
                    const avatarCenterY = top + height / 2;
                    const angle = Math.atan2(clientY - avatarCenterY, clientX - avatarCenterX);
                    const distance = Math.min(1.5, Math.hypot(clientX - avatarCenterX, clientY - avatarCenterY) / 100);
                    const eyeX = Math.cos(angle) * distance;
                    const eyeY = Math.sin(angle) * distance;
                    gsap.to([eyeLeft, eyeRight], { x: eyeX, y: eyeY, duration: 0.3, ease: 'power2.out' });
                }
            });

            // Chat functionality
            const toggleChat = (show) => {
                if (show) {
                    chatWindow.classList.remove('hidden');
                    avatarBtn.classList.add('hidden');
                    if (messagesContainer.children.length === 0) {
                        addBotMessage("Hello! I'm AgriBot, your personal AI farming partner. How can I help you today? You can ask me to 'analyze my crop'.");
                    }
                } else {
                    chatWindow.classList.add('hidden');
                    avatarBtn.classList.remove('hidden');
                }
            };

            avatarBtn.addEventListener('click', () => toggleChat(true));
            closeBtn.addEventListener('click', () => toggleChat(false));

            const addMessage = (text, sender) => {
                const messageEl = document.createElement('div');
                messageEl.className = `chat-message p-3 rounded-xl ${sender === 'user' ? 'user-message' : 'bot-message'}`;
                messageEl.textContent = text;
                messagesContainer.appendChild(messageEl);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            };

            const addBotMessage = (text) => addMessage(text, 'bot');

            const showTypingIndicator = () => {
                const typingEl = document.createElement('div');
                typingEl.id = 'typing-indicator';
                typingEl.className = 'chat-message bot-message p-3 rounded-xl flex items-center gap-1';
                typingEl.innerHTML = `<span class="w-2 h-2 bg-gray-500 rounded-full inline-block"></span><span class="w-2 h-2 bg-gray-500 rounded-full inline-block"></span><span class="w-2 h-2 bg-gray-500 rounded-full inline-block"></span>`;
                messagesContainer.appendChild(typingEl);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            };

            const removeTypingIndicator = () => document.getElementById('typing-indicator')?.remove();

            const getBotResponse = (userInput) => {
                // This function needs access to the globally defined `farmersData`
                // It's defined in the other script block, so it should be available.
                return window.getBotResponse(userInput);
            };

            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const userInput = inputField.value.trim();
                if (!userInput) return;
                addMessage(userInput, 'user');
                inputField.value = '';
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    const botResponse = getBotResponse(userInput);
                    addBotMessage(botResponse);
                }, 1500 + Math.random() * 1000);
            });
        });
    })(); 
    </script>
</body>
</html>
